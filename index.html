<!DOCTYPE html>
<html lang="en">
  <head>    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>FEGS Scoping Tool</title>
    <link type="text/css" rel="stylesheet" href="./css/s.css" media="all" />
    <style>
      body {
        margin: 1em;
        zoom: 70%;
        -moz-transform: scale(.7);
        -moz-transform-origin: 0 0;
      }
      #page-zoom-indicator {
        display: inline-block;
        width: 3em;
      }
      * {
        font-family: arial, sans-serif;
      }
      [aria-hidden="true"] {
        display: none;
      }
      .magnitude { background: #4f81bd; }
      .influence { background: #c0504d; }
      .interest { background: #9bbb59; }
      .urgency {  background: #8064a2; }
      .proximity { background: #4bacc6; }
      .economic-interest { background: #f79646; }
      .rights { background: #2c4d75; }
      .fairness { background: #772c2a; }
      .representation { background: #5f7530; }
      .agricultural { background: #DDD9C4; }
      .commercial { background: #C5D9F1; }
      .governmental { background: #E4DFEC; }
      .transportation { background: #F2DCDB; }
      .subsistence { background: #F9FDD1; }
      .recreational { background: #DAEEF3; }
      .inspirational { background: #EBF1DE; }
      .learning { background: #FDE9D9; }
      .nonuse { background: #F2F2F2; }
      .legend {
        width: 20px;
        height: 20px;
        border: 1px solid rgba(0, 0, 0, .2);
        display: inline-block;
      }
      @media (min-width: 600px) {
        .legend {
          margin: 35%;
        }
      }
      .scoring input {
        max-width: 4em;
      }
      .scoring {
        margin: 1em 0;
        min-width: 300px;
        display: inline-block;
      }
      [data-th='Color'] {
        margin-top: 1em;
      }
      .scoring th {
        position: absolute;
        left: -10000px;
      }
      .scoring td {
        display: block;
      }
      .scoring td:first-child {
        padding-top: .1em;
      }
      .scoring td:last-child {
        padding-bottom: .1em;
      }
      .scoring td:before {
        content: attr(data-th) ": ";
        font-weight: bold;
        display: inline;
      }
      @media (min-width: 600px) {
        .scoring td:before {
          display: none;
        }
      }
      .scoring th, .scoring td {
        text-align: left;
      }
      @media (min-width: 600px) {
        .scoring th, .scoring td {
          display: table-cell;
        }
        .scoring th:first-child, .scoring td:first-child {
          padding-left: 0;
        }
        .scoring th:last-child, .scoring td:last-child {
          padding-right: 0;
        }
        [data-th='Color'] {
          margin-top: 0;
        }
        .scoring th {
          position: unset;
          left: auto;
        }
      }

      .scoring th, .scoring td:before {
        color: #555;
      }

      .dark { background: rgba(128, 128, 128, .25); }

      .light-gray {
        background-color: #d6d7d9;
        border-radius: 3px;
        padding: 1em 1em 1em 1em;
        margin-bottom: .4em;
      }
      #stakeholder-list {
        list-style: none;
        display: none;
      }
      .stakeholder-value-list {
        list-style: none; 
      }

      #table-stakeholders td, #table-stakeholders th {
        border: 1px solid #d6d7d9;
        padding: 8px;
      }
      #stakeholder-table-container {
        display: none;
      }
      #table-stakeholders tr:nth-child(even){
        background-color: #f1f1f1;
      }
      #table-stakeholders th {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #0071bc;
        color: white;
      }
      #table-stakeholders {
        border-collapse: collapse;
        width: 100%;
      }
      table input {
        width: calc(100% - 2em);
        text-align: right;
        margin: .5em 1em;
        padding: .2em;
      }
      table {
        border-collapse: collapse;
        margin-bottom: 1em;
      }
      table th {
        text-align: center;
      }
      table th {
        padding: .5em;
      }
      td {
        padding: .3em;
      }
      .column-name-labels {
        border-bottom: 1px dashed darkgrey;
      }
      .column-names th {
        border-bottom: 1px solid black;
      }
      .row-name {
        border-right: 1px solid black;
      }
      .invalid-text-input {
        background-color: red;
      }
      .display-none {
        display: none;
      }
      html, body {
        height: 100%;
        margin: 0;
        font-size: 20px;
      }
      #menu {
        width: 15%;
        position: fixed;
        border-right: 1px solid #5b616b;
        height: 100%;
        background-color: #e4e2e0;
        font-size: 18px;
        min-width: 134px;
      }
      #menu-title {
        font-weight: bold;
      }
      #menu a {
        color: #000;
        text-decoration: none;
      }
      #menu a:hover {
        text-decoration: underline;
      }
      #menu ul {
        list-style: none;
        padding-left: 10px;
      }
      #menu li {
        margin: 10px;
        padding: 5px;
        border-radius: 2px;
      }
      #main-content {
        width: 85%;
        position: absolute;
        right: 0;
        margin: 0.5em -0.5em;
      }
      .active {
        font-weight: bold;
        background-color: #aeb0b5;
      }
      .remove-stakeholder {
        background-color: #cd2026;
        color: #fff;
        margin: 0 0 0 10px;
        padding: 0.25em .5em;
        cursor: pointer;
      }
      #show-only-these-columns {
        display: inline;
      }
      .progress-menu {
        font-weight: normal;
        font-size: 15px;
      }
      #set-stakeholder-values {
        display: none;
      }
      #show-name {
        display: inline;
        font-family: "Merriweather", "Georgia", "Cambria", "Times New Roman", "Times", serif;
        font-weight: bold;
        line-height: 1.3;
        margin: 0;
        text-rendering: optimizeLegibility;
      }
    </style>

  </head>
  <body>
    <div id="main-content">
    <h1 id="app-name">FEGS Scoping Tool</h1>

    <h2>
      Project Name:
      <span id="show-name"></span>
      <input id="input-name" type="text"></input>
    </h2>
    <button onclick="fegsScopingView.editName()" id="change-name">Change the Project's Name</button>
    <button onclick="fegsScopingController.updateName(document.getElementById('input-name').value)" id="save-name">Save this Name</button>

    <button onclick="var view = new FEGSScopingView(); view.focusPage('section-scoring');">Paginate App</button>

    <button id="restore" onclick="fegsScopingController.saveValidatedData();">Save Data</button>

    <button id="scrape-page" onclick="fegsScopingController.restoreData()//FIXME load data">Load Data</button>

    Zoom: <span id="page-zoom-indicator">0.7</span> <input id="page-zoom" max="2" min="0.25" onchange="pageZoomChange(event)" oninput="indicatePageZoom(event)" step="0.01" type="range" value=".7"></input>

    <div class="page" id="section-weighting">
      <h3>Weighting</h3>
      <p>Look over the criteria below. Identify the criterion that you value the most. Give that criterion a weight of 100. Weight all other criteria relative to that most valued criterion.</p>
      <table class="scoring" id="table-scores">
        <thead>
          <tr>
            <th>Color</th>
            <th>Label</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-th="Color"><span class="legend magnitude"></span></td>
            <td data-th="Label">Magnitude/Probability of impact</td>
            <td data-th="Value"><input id="magnitude-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend influence"></span></td>
            <td data-th="Label">Level of influence</td>
            <td data-th="Value"><input id="influence-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend interest"></span></td>
            <td data-th="Label">Level of interest</td>
            <td data-th="Value"><input id="interest-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend urgency"></span></td>
            <td data-th="Label">Urgency/ Temporal immediacy</td>
            <td data-th="Value"><input id="urgency-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend proximity"></span></td>
            <td data-th="Label">Proximity</td>
            <td data-th="Value"><input id="proximity-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend economic-interest"></span></td>
            <td data-th="Label">Economic interest</td>
            <td data-th="Value"><input id="economic-interest-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend rights"></span></td>
            <td data-th="Label">Rights</td>
            <td data-th="Value"><input id="rights-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend fairness"></span></td>
            <td data-th="Label">Fairness</td>
            <td data-th="Value"><input id="fairness-score" type="number"/></td>
          </tr>
          <tr>
            <td data-th="Color"><span class="legend representation"></span></td>
            <td data-th="Label">Underrepresented/Underserved representation</td>
            <td data-th="Value"><input id="representation-score" type="number"/></td>
          </tr>
        </tbody>
      </table>
      <span id="pie"></span>
    </div>

    <div class="page" id="section-stakeholders">
      <h3>Add Stakeholders</h3>
      <p>Identify your stakeholder-groups.</p>
      <div id="stakeholder-prioritization">
        <div>    
          <div class="light-gray">
            <label>Stakeholder-group name <input type="text" id="stakeholder-group"/></label>
            <button id="add-stakeholder" onclick="addStakeholder();">Add stakeholder-group</button>
            <ul id="stakeholder-list"></ul>
          </div>
        </div>
        <br />
        <br />
        <div id="set-stakeholder-values">
          <h3>Score Stakeholders</h3>
          <p>Score each stakeholder-group for each of the 9 criteria.</p>
          <div>
            <div class="light-gray">
              <h4>Magnitude/Probability of impact</h4>
              <p>If changes are made in this decision context what is the likelihood that this stakeholder group will be impacted? What is the potential magnitude of that impact?</p>
              <p>Please enter a number 0 to 100.</p>
              <ul data-criterion="magnitude" class="stakeholder-value-list"></ul>
              <img src="img\probabilitymagnitude.PNG" width="300">
            </div>
          </div>
          <div>
            <div class="light-gray">
              <h4>Level of influence</h4>
              <p>Does this stakeholder-group have any formal or informal influence over the decision making process?</p>
              <p>Please enter a number 0 to 100.</p>
              <ul>
                <li>100 = This group has formal influence over the decision-making process (i.e. can have the project stopped, must be consulted with).</li>
                <li>50 = This group has informal influence over the decision-making process.</li>
                <li>0 = This group has no influence over the decision-making process.</li>
              </ul>
              <ul data-criterion="influence" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <div>
            <div class="light-gray">  
              <h4>Level of interest</h4>
              <p>What is this stakeholder-group's level of interest in this decision/action?</p>
              <p>Please enter a number 0 to 100.</p>
              <ul>
                <li>100 = High.</li>
                <li>75 = Moderate.</li>
                <li>50 = Low.</li>
                <li>0 = None.</li>
              </ul>
              <ul data-criterion="interest" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <div>
            <div class="light-gray">
              <h4>Urgency/Temporal immediacy</h4>
              <p>Does this stakeholder-group want an immediate decision/action on this issue?</p>
              <ul>
                <li>100 = Yes, even if other actions/decisions must be postponed.</li>
                <li>80 = Yes, as long as it does not delay current commitments.</li>
                <li>60 = They would like to see action/a decision within a relatively short timeframe.</li>
                <li>40 = They would like to see action/a decision within a medium range timeframe.</li>
                <li>20 = They would like to see action/a decision made, but have no timeframe for it.</li>
                <li>0 = They do not care when an action/decision takes place.</li>
              </ul>
              <ul data-criterion="urgency" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <div>
            <div class="light-gray">  
              <h4>Proximity</h4>
              <p>How frequently does this stakeholder-group come into contact with the area subject to this decision?</p>
              <ul>
                <li>100 = They are constantly in direct contact with the area.</li>
                <li>75 = They are constantly in contact with areas adjacent to the area OR They are frequently in direct contact with the area.</li>
                <li>50 = They are frequently in contact with areas adjacent to the area OR They are infrequently in direct contact with the area.</li>
                <li>25 = They are infrequently in contact with areas adjacent to the area.</li>
                <li>10 = They interact with this area from a distance.</li>
                <li>0 = They are never in contact with the area.</li>
              </ul>
              <ul data-criterion="proximity" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <div>
            <div class="light-gray">
              <h4>Economic interest</h4>
              <p>Does this stakeholder-group have an economic interest in the outcome of this decision?</p>
              <ul>
                <li>100 = Yes.</li>
                <li>0 = No.</li>
              </ul>
              <ul data-criterion="economic-interest" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <div>
            <div class="light-gray">  
              <h4>Rights</h4>
              <p>Does this stakeholder-group have any 1) legal right to be involved in this decision making process, 2) property rights associated with the land that will be impacted by the decision, or 3) consumer/user rights associated with the services that will be impacted by the decision?</p>
              <ul>
                <li>100 = Yes, all 3.</li>
                <li>60 = Yes, 2 of the 3.</li>
                <li>20 = Yes, 1 of the 3.</li>
                <li>0 = No.</li>
              </ul>
              <ul data-criterion="rights" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <div>
            <div class="light-gray">  
              <h4>Fairness</h4>
              <p>If this stakeholder-group is not considered in decision-making, would the resulting decision be seen as unfair?</p>
                <ul>
                  <li>100 = Yes.</li>
                  <li>0 = No.</li>
                </ul>
                <ul data-criterion="fairness" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <div>
            <div class="light-gray">
              <h4>Underrepresented/Underserved representation</h4>
              <p>Does this stakeholder-group represent underserved or underrepresented groups?</p>
              <ul>
                <li>100 = Yes.</li>
                <li>0 = No.</li>
              </ul>
              <ul data-criterion="representation" class="stakeholder-value-list"></ul>
            </div>
          </div>
          <button onclick="addStakeholderScores();">Add stakeholder scores</button>
        </div>
      </div>
      <div id="stakeholder-table-container">
        <h3>Stakeholders</h3>
        <table id="table-stakeholders">
          <thead>
            <tr>
              <th></th>
              <th>Stakeholder-group</th>
              <th>Magnitude/Probability of impact</th>
              <th>Level of influence</th>
              <th>Level of interest</th>
              <th>Urgency/Temporal immediacy</th>
              <th>Proximity</th>
              <th>Economic interest</th>
              <th>Rights</th>
              <th>Fairness</th>
              <th>Underrepresented/Underserved representation</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="11"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="page" id="section-beneficiary-definitions">
      <h3>Beneficiary Definitions</h3>

      <table id="table-beneficiary-definitions">
        <tr class="agricultural"><th rowspan="7">Agricultural</th><th>Irrigators</th><td>Irrigator, irrigation, watering</td></tr>
        <tr class="agricultural"><th>CAFO Operators</th><td>CAFO; feeding operations or feed lots for livestock (cattle, hogs, or poultry), livestock production</td></tr>
        <tr class="agricultural"><th>Livestock grazers</th><td>Ranches or grazing for livestock (cattle, hogs, or poultry), cattle range</td></tr>
        <tr class="agricultural"><th>Agricultural processors</th><td>Agricultural or farm processors or processing; agricultural or farm production or products (but not seafood)</td></tr>
        <tr class="agricultural"><th>Aquaculturalists</th><td>Aquaculture or aquafarming; farms or hatcheries for shellfish, fish, oysters, clams, mussels, shrimp, or aquatic plants </td></tr>
        <tr class="agricultural"><th>Farmers</th><td>Farmer, farming, farm (but not aquaculture); plantation, crops, orchards</td></tr>
        <tr class="agricultural"><th>Foresters</th><td>Forester or forestry; tree farm; silviculture</td></tr>
        <tr class="commercial"><th rowspan="8">Commercial/ Industrial</th><th>Food extractors</th><td>Food extraction; hunting or trapping for livelihood, job, or commercial purpose; commercial or artisanal fishing, shrimping, clamming</td></tr>
        <tr class="commercial"><th>Timber/Fiber/  Ornamental extractors</th><td>Timber, fiber, wood, or ornament extraction or harvest for commercial or business purposes; logging or logger; oyster harvest, abalone collecting</td></tr>
        <tr class="commercial"><th>Industrial processors</th><td>Industrial processing or production, ; manufacturing; textile, steel, or industries or production; mills; oil and gas industry (including extraction & processing); mining; food (meat, sugar, grain, vegetable, fruit) processing</td></tr>
        <tr class="commercial"><th>Industrial dischargers</th><td>Industrial discharge or wastewater </td></tr>
        <tr class="commercial"><th>Energy generators</th><td>Power plant, electric, hydroelectric; solar, wind, hydro, renewable, nuclear power or energy; thermoelectric cooling</td></tr>
        <tr class="commercial"><th>Resource-dependent businesses</th><td>Businesses that rely or depend on local resources; marina, tourism, , resort, hotel, shop, restaurant, local business, developed or working waterfronts; outfitter, fishing/hunting guide; fishing charter, tour boats</td></tr>
        <tr class="commercial"><th>Pharmaceutical/ Food supplement suppliers</th><td>Pharmaceuticals, medicines; food supplements, vitamins; </td></tr>
        <tr class="commercial"><th>Fur/Hide trappers/hunters</th><td>Hunting or trapping for animal skin, hide, fur </td></tr>
        <tr class="governmental"><th rowspan="4">Governmental/Municipal/     Residential</th><th>Municipal drinking water plant operators</th><td>Drinking water, municipal water supply</td></tr>
        <tr class="governmental"><th>Wastewater treatment plant operators</th><td>Wastewater or sewage treatment; treatment plant</td></tr>
        <tr class="governmental"><th>Residential property owners</th><td>Homeowners, private land,  or property, landowner; Residential areas, neighborhoods, or development</td></tr>
        <tr class="governmental"><th>Military/Coast Guard</th><td>Military, coast guard, navy, army, shipyard</td></tr>
        <tr class="transportation"><th rowspan="2">Commercial/  Military Transportation</th><th>Transporters of goods</th><td>Goods transport, shipping, cargo, commercial navigation, port, vessel, barge, freight, bulk commodities, containers</td></tr>
        <tr class="transportation"><th>Transporters of people</th><td>People transport, cruise, ferry, ferries, airplane, airport, train, harbor</td></tr>
        <tr class="subsistence"><th rowspan="4">Subsistence</th><th>Water subsisters</th><td>Cistern,  rain garden, rain barrel; water for subsistence, including tribal or traditional use</td></tr>
        <tr class="subsistence"><th>Food subsisters</th><td>Food for subsistence; hunting, fishing, collecting, or gathering food to cook or eat; digging shellfish or clams; including tribal or traditional use, wild rice</td></tr>
        <tr class="subsistence"><th>Timber/Fiber/Fur/  Hide subsisters</th><td>Collect timber, fiber, fur, or hides for subsistence, including tribal or cultural traditions; firewood </td></tr>
        <tr class="subsistence"><th>Building material subsisters</th><td>Collecting building materials for subsistence, including tribes or cultural traditions</td></tr>
        <tr class="recreational"><th rowspan="6">Recreational</th><th>Experiencers/   viewers</th><td>Bird, wildlife, or fauna watching; nature appreciation; hiking, biking, camping, climbing, outings, sunbathing, sightseeing, beach combing; viewing (i.e., observing, enjoying, experiencing, relaxing, outings) nature (e.g., outdoors, wildlife, wildflowers, animals, trails)</td></tr>
        <tr class="recreational"><th>Food pickers/gatherers</th><td>Collect or gather berries, mushrooms; dig for shellfish or clams; wild rice</td></tr>
        <tr class="recreational"><th>Hunters</th><td>Hunting for recreation or sport </td></tr>
        <tr class="recreational"><th>Anglers</th><td>Anglers, fishing for recreation or sport </td></tr>
        <tr class="recreational"><th>Waders/Swimmers/Divers</th><td>Snorkeling, SCUBA, swimming, beachgoing, wading, diving, bathing </td></tr>
        <tr class="recreational"><th>Boaters</th><td>Boat, canoe, kayak, rowing, sailing, jet ski, surfing, watercraft</td></tr>
        <tr class="inspirational"><th rowspan="2">Inspirational</th><th>Spiritual and ceremonial participants</th><td>Festival, observance, religion, ceremony, baptism, wedding, spiritual, worship, prayer</td></tr>
        <tr class="inspirational"><th>Artists</th><td>Writer, author, poet, painter, artist, sculptor, carver, pottery, photography</td></tr>
        <tr class="learning"><th rowspan="2">Learning</th><th>Students and educators</th><td>Educational use, resource, interest, or opportunity; academic, teaching, professor, student; secondary schools (elementary, middle, high); school children; field trips or outdoor laboratories</td></tr>
        <tr class="learning"><th>Researchers</th><td>Opportunities or interest for significant scientific research and improving scientific knowledge, investigation, research, questions </td></tr>
        <tr class="nonuse"><th rowspan="2">Non-Use</th><th>People who care (existence)</th><td>Caring, concern, conservation, or appreciation by the community (citizens, stakeholders, people, residents, anyone, everyone, children, families); Existence value; History; Culture </td></tr>
        <tr class="nonuse"><th>People who care (option, bequest)</th><td>Bequest, option, legacy, or heritage value; future or next generation (grandchildren)</td></tr>
      </table>

    </div>

    <div class="page" id="section-beneficiaries">
      <h3>Beneficiaries</h3>

      <label for="select-stakeholder-to-slice-into-beneficiaries">
        Identify the types of beneficiaries making up each stakeholder-group by percentage.     
        <br />
        <select id="select-stakeholder-to-slice-into-beneficiaries" onchange="selectStakeholderToSlice()">
          <option selected="selected" disabled="disabled">Select a Stakeholder-Group</option>
        </select>
      </label>

      <table id="table-beneficiaries">
        <thead>
          <tr><th>Category</th><th>Subcategory</th></tr>
        </thead>
        <tbody>
          <tr><th class="agricultural" rowspan="7">Agricultural</th><th class="agricultural">Irrigators</th></tr>
          <tr><th class="agricultural">CAFO Operators</th></tr>
          <tr><th class="agricultural">Livestock grazers</th></tr>
          <tr><th class="agricultural">Agricultural processors</th></tr>
          <tr><th class="agricultural">Aquaculturalists</th></tr>
          <tr><th class="agricultural">Farmers</th></tr>
          <tr><th class="agricultural">Foresters</th></tr>
          <tr><th class="commercial" rowspan="8">Commercial/Industrial</th><th class="commercial">Food extractors</th></tr>
          <tr><th class="commercial">Timber/Fiber/Ornamental extractors</th></tr>
          <tr><th class="commercial">Industrial processors</th></tr>
          <tr><th class="commercial">Industrial dischargers</th></tr>
          <tr><th class="commercial">Energy generators</th></tr>
          <tr><th class="commercial">Resource-dependent businesses</th></tr>
          <tr><th class="commercial">Pharmaceutical/Food supplement suppliers</th></tr>
          <tr><th class="commercial">Fur/Hide trappers/hunters</th></tr>
          <tr><th class="governmental" rowspan="4">Governmental/Municipal/Residential</th><th class="governmental">Municipal drinking water plant operators</th></tr>
          <tr><th class="governmental">Wastewater treatment plant operators</th></tr>
          <tr><th class="governmental">Residential property owners</th></tr>
          <tr><th class="governmental">Military/Coast Guard</th></tr>
          <tr><th class="transportation" rowspan="2">Commercial/Military Transportation</th><th class="transportation">Transporters of goods</th></tr>
          <tr><th class="transportation">Transporters of people</th></tr>
          <tr><th class="subsistence" rowspan="4">Subsistence</th><th class="subsistence">Water subsisters</th></tr>
          <tr><th class="subsistence">Food subsisters</th></tr>
          <tr><th class="subsistence">Timber/Fiber/Fur/Hide subsisters</th></tr>
          <tr><th class="subsistence">Building material subsisters</th></tr>
          <tr><th class="recreational" rowspan="6">Recreational</th><th class="recreational">Experiencers/viewers</th></tr>
          <tr><th class="recreational">Food pickers/gatherers</th></tr>
          <tr><th class="recreational">Hunters</th></tr>
          <tr><th class="recreational">Anglers</th></tr>
          <tr><th class="recreational">Waders/Swimmers/Divers</th></tr>
          <tr><th class="recreational">Boaters</th></tr>
          <tr><th class="inspirational" rowspan="2">Inspirational</th><th class="inspirational">Spiritual and ceremonial participants</th></tr>
          <tr><th class="inspirational">Artists</th></tr>
          <tr><th class="learning" rowspan="2">Learning</th><th class="learning">Students and educators</th></tr>
          <tr><th class="learning">Researchers</th></tr>
          <tr><th class="nonuse" rowspan="2">Non-Use</th><th class="nonuse">People who care (existence)</th></tr>
          <tr><th class="nonuse">People who care (option, bequest)</th></tr>
        </tbody>
      </table>

    </div>

    <div class="page" id="section-attribute-definitions">
      <h3>Attribute Definitions</h3>

      <table id="table-attribute-definitions">
        <tr class="dark">
          <td>Weather</td>
          <td>Weather (e.g., climate, seasons, rain, temperature, snow, ice, summer, spring, winter, autumn) available to enjoy (e.g., for recreation, tourism, sunbathing) or favorable for activities (e.g., agriculture)</td>
        </tr>
        <tr class="dark">
          <td>Air</td>
          <td>Clean, safe, healthy air for breathing; Availability of air for industrial discharges or emission, to transport and ameliorate odors (e.g., smells, fumes), or to transport and deposit pollutants (e.g., deposition, rain fall); </td>
        </tr>
        <tr class="dark">
          <td>Wind</td>
          <td>Wind available to enjoy (e.g., boating, surfing, recreation) or for commercial uses (e.g., energy, electricity, power)</td>
        </tr>
        <tr class="dark">
          <td>Atmospheric Phenomena</td>
          <td>Generate or create fog; aesthetic, scenic, or inspirational value of clouds, sunrise, sunsets, morning, or twilight; </td>
        </tr>
        <tr>
          <td>Sounds and Scents</td>
          <td>Natural sounds, noises, scents, and smells (i.e., sensory, olfactory, auditory resources) available to hear and enjoy, including bird songs or calls, croaking, chirping, rustling, splashing, thunder, ocean waves, flowers, plants, berries, the beach </td>
        </tr>
        <tr>
          <td>Viewscapes</td>
          <td>Opportunities for scenic (e.g., beautiful, inspirational, spectacular) views (e.g., viewscape, vista, landscape, overlook)</td>
        </tr>
        <tr class="dark">
          <td>Open Space</td>
          <td>Open space (e.g., greenspace, greenways, parks, nature preserves) that is available to enjoy, appreciate, or other opportunities (e.g., aesthetics, recreation, scenery)</td>
        </tr>
        <tr class="dark">
          <td>Presence of the Environment</td>
          <td>Opportunities for recreation (e.g., camping, hiking, diving, snorkeling, swimming, sunbathing, sightseeing, walking, biking, outing, trails),  aesthetic enjoyment (e.g., atmosphere, appreciation), or non-use value (e.g., existence, bequest); Provide or generate clean air; Purify, filter, buffer, or clean air pollutants or the atmosphere; Provide or improve air quality; nitrogen fixation; improve respiratory health or reduce asthma; reduce carbon in the atmosphere; Erosion and flood control; Shoreline protection (e.g. dunes, mangroves, reefs); Filtering (e.g. buffering) sediment, nutrients, or water pollutants; Shading by trees (e.g., canopy cover)</td>
        </tr>
        <tr class="dark">
          <td>Land</td>
          <td>Availability of land, coast, or wetland for residential or commercial development, including sprawl, or for disposal sites; Land identified for protection (e.g, preserve, restore, conserve, easement, trust); Public lands of unspecified use</td>
        </tr>
        <tr class="dark">
          <td>Water</td>
          <td>Water as a resource for consumption (e.g., drinking); a resource for industry (e.g., cooling, hydroelectricity), households (e.g., rain barrels), or agriculture (e.g., irrigation); as a medium to receive & dilute discharges (e.g., wastewater, ballast) or for transportation (e.g., boat or ship navigation)</td>
        </tr>
        <tr>
          <td>Soil</td>
          <td>Availability of soil (e.g., dirt, sediment) for farming, gardening, to absorb effluent, as a nutrient source for the estuary (i.e., sediment flux), or for other uses, including soil microorganisms that affect quantity and quality through decomposition or nutrient availability (e.g., nitrogen, carbon) </td>
        </tr>
        <tr>
          <td>Substrate</td>
          <td>Natural substrate, ground, or surfaces (e.g., clay, chalk, bedrock, limestone, granite, marble, sand, oyster reef, renourished beaches) available for construction, agriculture, aquaculture, or other uses</td>
        </tr>
        <tr>
          <td>Timber</td>
          <td>Natural wood available as timber, logs, or lumber for household, commercial, or industrial uses</td>
        </tr>
        <tr>
          <td>Fiber</td>
          <td>Fiber (e.g., salt hay, grass, reeds) collected, harvested, or gathered for use, subsistence, or other benefits (e.g., products, milling, industry, pottery)</td>
        </tr>
        <tr>
          <td>Natural Materials</td>
          <td>Natural materials that are collected for artistic use (e.g. ornaments or jewelry) or consumption, including rocks, shells, coral skeletons, clay, acorns, honey, maple syrup, sand;</td>
        </tr>
        <tr class="dark">
          <td>Fauna</td>
          <td>Wildlife or animals, including terrestrial and aquatic mammals, birds, reptiles, amphibians, and insects that are unique (e.g., charismatic, endangered, biodiversity, beauty, special), enjoyed as a resource (e.g., observation, watching, collecting, hunting, trapping), or identified for conservation (e.g., protect, restore, preserve) </td>
        </tr>
        <tr class="dark">
          <td>Fish</td>
          <td>Wild fish or shellfish (e.g., salmon, oyster, pike, crab, mullet, mussel, bass, herring, grouper, snapper, alewife, flounder, abalone, scallop, worm, clam, geoduck) harvested for seafood consumption or other industrial, commercial, recreational uses; Fish that are unique (e.g., charismatic, endangered, biodiversity, beauty, special) or identified for conservation (e.g., protect, restore, preserve)</td>
        </tr>
        <tr class="dark">
          <td>Flora</td>
          <td>Flora (e.g., grass, kelp, seaweed, vegetation, mangroves, trees, moss, sedge, lichens, berries, cypress, pine, oak, elm, etc.), including plant parts (e.g., flowers, branches, sticks), that are unique (e.g., charismatic, endangered, biodiversity, beauty, special), enjoyed as a resource (e.g., observation, sightseeing, collecting, consumption, cuttings), or identified for conservation (e.g., protect, restore, preserve)</td>
        </tr>
        <tr class="dark">
          <td>Fungi</td>
          <td>Wild fungi (i.e., mushrooms) that are unique (e.g., charismatic, endangered, biodiversity, beauty, special), enjoyed as a resource (e.g., observation, sightseeing, collecting, consumption), or identified for conservation (e.g., protect, restore, preserve)</td>
        </tr>
        <tr>
          <td>Pollinators</td>
          <td>Bees, butterflies, or other animals (e.g., bats, birds) that distribute pollen for plants (e.g., flowers, flora, crops, farms, agriculture, gardens)</td>
        </tr>
        <tr>
          <td>Depredators and (Pest) Predators</td>
          <td>Biological control (biocontrol); control of pests, invasives, exotics, or nuisance species by predators; natural control or populations or species</td>
        </tr>
      </table>

    </div>

    <div class="page" id="section-attributes">
      <h3>Attributes</h3>

      <table id="table-beneficiary-scores">
        <colgroup>
          <col />
          <col class="agricultural" span="7" />
          <col class="commercial" span="8" />
          <col class="governmental" span="4" />
          <col class="transportation" span="2" />
          <col class="subsistence" span="4" />
          <col class="recreational" span="6" />
          <col class="inspirational" span="2" />
          <col class="learning" span="2" />
          <col class="nonuse" span="2" />
        </colgroup>
        <thead>
          <tr>
            <td></td>
            <th colspan="7">Agricultural</th>
            <th colspan="8">Commercial/ Industrial</th>
            <th colspan="4">Governmental/Municipal/Residential</th>
            <th colspan="2">Commercial/  Military Transportation</th>
            <th colspan="4">Subsistence</th>
            <th colspan="6">Recreational</th>
            <th colspan="2">Inspirational</th>
            <th colspan="2">Learning</th>
            <th colspan="2">Non-Use</th>
          </tr>
          <tr>
            <td></td>
            <th>Irrigators</th>
            <th>CAFO Operators</th>
            <th>Livestock grazers</th>
            <th>Agricultural processors</th>
            <th>Aquaculturalists</th>
            <th>Farmers</th>
            <th>Foresters</th>
            <th>Food extractors</th>
            <th>Timber/Fiber/Ornamental extractors</th>
            <th>Industrial processors</th>
            <th>Industrial dischargers</th>
            <th>Energy generators</th>
            <th>Resource-dependent businesses</th>
            <th>Pharmaceutical/Food supplement suppliers</th>
            <th>Fur/Hide trappers/hunters</th>
            <th>Municipal drinking water plant operators</th>
            <th>Wastewater treatment plant operators</th>
            <th>Residential property owners</th>
            <th>Military/Coast Guard</th>
            <th>Transporters of goods</th>
            <th>Transporters of people</th>
            <th>Water subsisters</th>
            <th>Food subsisters</th>
            <th>Timber/Fiber/Fur/Hide subsisters</th>
            <th>Building material subsisters</th>
            <th>Experiencers/viewers</th>
            <th>Food pickers/gatherers</th>
            <th>Hunters</th>
            <th>Anglers</th>
            <th>Waders/Swimmers/Divers</th>
            <th>Boaters</th>
            <th>Spiritual and ceremonial participants</th>
            <th>Artists</th>
            <th>Students and educators</th>
            <th>Researchers</th>
            <th>People who care (existence)</th>
            <th>People who care (option, bequest)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>Beneficiary Score</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>

      <h3 id="table-attributes-header">Score Attributes for each Beneficiary</h3>

      <table id="table-attributes">
        <colgroup>
          <col class="row-labels" />
          <col class="agricultural" span="7" />
          <col class="commercial" span="8" />
          <col class="governmental" span="4" />
          <col class="transportation" span="2" />
          <col class="subsistence" span="4" />
          <col class="recreational" span="6" />
          <col class="inspirational" span="2" />
          <col class="learning" span="2" />
          <col class="nonuse" span="2" />
        </colgroup>
        <thead>
          <tr class="column-name-labels">
            <th class="row-label-header">Row labels</th>
            <th colspan="7">Agricultural</th>
            <th colspan="8">Commercial/ Industrial</th>
            <th colspan="4">Governmental/Municipal/Residential</th>
            <th colspan="2">Commercial/  Military Transportation</th>
            <th colspan="4">Subsistence</th>
            <th colspan="6">Recreational</th>
            <th colspan="2">Inspirational</th>
            <th colspan="2">Learning</th>
            <th colspan="2">Non-Use</th>
          </tr>
          <tr class="column-names">
            <th>Attribute</th>
            <th>Irrigators</th>
            <th>CAFO Operators</th>
            <th>Livestock grazers</th>
            <th>Agricultural processors</th>
            <th>Aquaculturalists</th>
            <th>Farmers</th>
            <th>Foresters</th>
            <th>Food extractors</th>
            <th>Timber/Fiber/Ornamental extractors</th>
            <th>Industrial processors</th>
            <th>Industrial dischargers</th>
            <th>Energy generators</th>
            <th>Resource-dependent businesses</th>
            <th>Pharmaceutical/Food supplement suppliers</th>
            <th>Fur/Hide trappers/hunters</th>
            <th>Municipal drinking water plant operators</th>
            <th>Wastewater treatment plant operators</th>
            <th>Residential property owners</th>
            <th>Military/Coast Guard</th>
            <th>Transporters of goods</th>
            <th>Transporters of people</th>
            <th>Water subsisters</th>
            <th>Food subsisters</th>
            <th>Timber/Fiber/Fur/Hide subsisters</th>
            <th>Building material subsisters</th>
            <th>Experiencers/viewers</th>
            <th>Food pickers/gatherers</th>
            <th>Hunters</th>
            <th>Anglers</th>
            <th>Waders/Swimmers/Divers</th>
            <th>Boaters</th>
            <th>Spiritual and ceremonial participants</th>
            <th>Artists</th>
            <th>Students and educators</th>
            <th>Researchers</th> <th>People who care (existence)</th>
            <th>People who care (option, bequest)</th>
          </tr>
        </thead>
        <tbody>
          <tr class="dark">
            <th class="row-name">Weather</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Air</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Wind</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Atmospheric Phenomena</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Sounds and Scents</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Viewscapes</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Open Space</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Presence of the Environment</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Land</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Water</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Soil</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Substrate</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Timber</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Fiber</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Natural Materials</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Fauna</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Fish</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Flora</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="dark">
            <th class="row-name">Fungi</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Pollinators</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th class="row-name">Depredators and (Pest) Predators</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>
  <div id="menu">
    <div id="menu-title">Menu</div>
    <ul>
      <li><a href="#section-weighting">Weighting</a><div id="weighting-progress" class="progress-menu"></div></li>
      <li><a href="#section-stakeholders">Stakeholders</a><div id="stakeholder-progress" class="progress-menu"></div></li>
      <li><a href="#section-beneficiary-definitions">Beneficiary Definitions</a></li>
      <li><a href="#section-beneficiaries">Beneficiaries</a><div id="beneficiaries-progress" class="progress-menu"></div></li>
      <li><a href="#section-attribute-definitions">Attribute Definitions</a></li>
      <li><a href="#section-attributes">Attributes</a></li>
    </ul>
  </div>

    <script>
      window.addEventListener("scroll", onScroll);
      function onScroll(event){
        var scrollPos = window.scrollY;
        var menuItems = document.getElementById("menu").getElementsByTagName('a');
        for (var i = 0; i < menuItems.length; i++) {
          var currentItem = menuItems[i];
          var hrefElement = document.getElementById(currentItem.getAttribute('href').replace('#', ''));
          if (hrefElement.offsetTop <= (scrollPos + 1) && hrefElement.offsetTop + hrefElement.offsetHeight > scrollPos) {
            currentItem.parentNode.classList.add("active");
          } else {
            currentItem.parentNode.classList.remove("active");
          }
        }
      }
      var getDocument = function() {
        var documentText = '<!DOCTYPE html>' + '\n' + document.documentElement.outerHTML;
        return documentText;
      }

      var downloadText = function (filename, text) {
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
      }

    </script>
<!-- FIXME: integrate code between comment flags into application -->
    <script src="./js/d3.min.js"></script>

    <script>

      /** Prototype data-model and its CRUD-methods. */
      var FEGSScopingData = function() {

        /**
         * This object-factory sets value as specified in arg criteria
         *  else to defaultValue.
         *
         * @param {string|Object.<string, string>} values - a single
         *  string to use as a value for all criteria or an object
         *  specifying each value as a numerical string indexed by
         *  its criterion
         */
        this.makeCriteriaObject = function(values) {
          var valuesObject = {};
          var defaultValue = '';
          var i;
          var valuesCriteria;
          if (typeof(values) === 'string') {
            for (i = 0; i < this.criteria.length; i++) {
              valuesObject[this.criteria[i]] = values;
            }
            return valuesObject;
          } else if (typeof(values) === 'object') {
            if (values.length) {
              throw 'Argument values should be an object or a string but values is neither.';
            }
            valuesCriteria = Object.keys(values);
            for (i = 0; i < valuesCriteria.length; i++) {
              if (String(this.criteria.indexOf(String(valuesCriteria[i]))) === '-1') {
                throw 'An unkown criterion was supplied as a key: ' + valuesCriteria[i];
              }
              valuesObject[valuesCriteria[i]] = values[valuesCriteria[i]];
            }
            for (i = 0; i < this.criteria.length; i++) {
              if (valuesCriteria.indexOf(this.criteria[i]) === -1) {
                valuesObject[this.criteria[i]] = defaultValue;
              }
            }
            return valuesObject;
          } else {
            throw 'expected values to be an object or a string but was neither';
          }
        };

        /**
         * add a stakeholder and its criteria-scores
         * @param {string} stakeholderName - name of stakeholder to add
         * @param {Object <string>.<string>} stakeholderScores -
         *  criteria are keys and respective scores for this
         *  stakeholder are values
         */
        this.addStakeholder = function(stakeholderName, stakeholderScores) {
          this.stakeholders[stakeholderName] = {scores: stakeholderScores, beneficiaries: {}};
        };

        /**
         * rename oldStakeholderName to newStakeholderName
         * @param {string} oldStakeholderName - current name of the stakeholder
         * @param {string} newStakeholderName - new name of the stakeholder
         */
        this.renameStakeholder = function(oldStakeholderName, newStakeholderName) {
          this.stakeholders[newStakeholderName] = this.stakeholders[oldStakeholderName];
          this.removeStakeholders([oldStakeholderName]);
        };

        /**
         * add a beneficiary and its percentage of its stakeholder
         * @param {string} stakeholderName - owner of beneficiary
         */
        this.addBeneficiary = function(stakeholderName, beneficiaryName, percentageOfStakeholder) {
          if (typeof(percentageOfStakeholder) === 'undefined') {
            percentageOfStakeholder = '';
          }
          this.stakeholders[stakeholderName]
              .beneficiaries[beneficiaryName] = {'percentageOfStakeholder': percentageOfStakeholder};
        };

        /**
         * add attributes to this.attributes
         * @param {string} beneficiaryName - owner of attributes
         * @param {Object <string>.<string>} attributes - keys are
         *  attribute-names and values are percentages of the
         *  corresponding attributes' owning beneficiary
         */
        this.addAttributes = function(beneficiaryName, attributes) {
          if (typeof(this.attributes) === 'undefined') {
            this.attributes = {};
          }
          this.attributes[beneficiaryName] = {};
          var keys = Object.keys(attributes)
          for (i = 0; i < keys.length; i++) {
            this.attributes[beneficiaryName][keys[i]] = {percentageOfBeneficiary: attributes[keys[i]]};
          }
        };

        /**
         * remove stakeholders named in an array
         * @param {Array.<string>} stakeholdersArray - names of
         *  stakeholders to be removed
         */
        this.removeStakeholders = function(stakeholdersArray) {
          for (var i = 0; i < stakeholdersArray.length; i++) {
            delete(this.stakeholders[stakeholdersArray[i]]);
          }
        };

        /**
         * remove beneficiaries named in an object of arrays
         *  where each key is a stakeholder's name and the
         *  corresponding array's elements are the
         *  beneficiaries owned by that stakeholder who are
         *  to be removed
         * @param {Object.<string,Array.<string>>} beneficiariesObject -
         *  beneficiaries to be removed specified as an object like
         *  {stakeholderName: [beneficiaryName]}
         */
        this.removeBeneficiariesFromStakeholder = function(beneficiariesObject) {
          var stakeholdersArray = Object.keys(beneficiariesObject);
          for (var i = 0; i < stakeholdersArray.length; i++) {
            var beneficiariesArray = beneficiariesObject[stakeholdersArray[i]];
            for (var j = 0; j < beneficiariesArray.length; j++) {
              delete(this.stakeholders[stakeholdersArray[i]]
                         .beneficiaries[beneficiariesArray[j]]);
            }
          }
        };

        /**
         * completely remove beneficiaries named in an array:
         *  remove listed beneficiaries from all stakeholders
         *  and from the keys of this.attributes
         * @param {Array.<string>} beneficiariesArray -
         *  beneficiaries to be removed specified as an object like
         *  [beneficiaryName]
         */
        this.removeBeneficiariesCompletely = function(beneficiariesArray) {
          var stakeholdersArray = Object.keys(this.stakeholders);
          for (var i = 0; i < stakeholdersArray.length; i++) {
            for (var j = 0; j < beneficiariesArray.length; j++) {
              delete(this.stakeholders[stakeholdersArray[i]]
                         .beneficiaries[beneficiariesArray[j]]);
              delete(this.attributes[beneficiariesArray[j]]);
            }
          }
        };

        /**
         * remove attributes named in an array
         * @param {Array.<string>} attributesArray -
         *  attributes to be removed specified like
         *  [attributeName]
         */
        this.removeAttributesCompletely = function(attributesArray) {
          var beneficiariesArray = Object.keys(this.attributes);
          for (var j = 0; j < beneficiariesArray.length; j++) {
            for (var k = 0; k < attributesArray.length; k++) {
              delete(this.attributes[benficiariesArray[k]][attributesArray[k]]);
            }
          }
        };

        /** assign properties of valuesObject to this */
        this.add = function(valuesObject) {
          Object.assign(this, valuesObject);
        };

        /**
         * sum percentageOfStakeholder for all optionally specified
         *  beneficiaries for each optionally specified stakeholder;
         *  if no stakeholders are specified then sum over all;
         *  if no beneficiaries are specified then sum over all;
         * @param {Array.<string>} stakeholderNames - names of
         *  stakeholders over whom to sum; sum over all if undefined
         * @param {Array.<string>} beneficiariesArray - names of
         *  beneficiaries over whom to sum; sum over all if undefined
         */
        this.sumBeneficiaryPercentages = function(stakeholderNames, beneficiaryNames) {
          if (typeof(stakeholderNames) === 'undefined') {
            stakeholderNames = Object.keys(this.stakeholders);
          }
          sum = 0;
          for (var i = 0; i < stakeholder; i++) {
            if (typeof(beneficiaryNames) === 'undefined') {
              beneficiaryArray = Object.keys(this.beneficiaries);
            } else {
              beneficiaryArray = beneficiaryNames;
            }
            for (var j = 0; j < beneficiaryArray.length; j++) {
              sum += +this.stakeholders[stakeholderNames[i]]
                          .beneficiaries[beneficiaryArray[j]]
                          .percentageOfStakeholder;
            }
          }
        };

        /**
         * sum percentageOfBeneficiary for all optionally specified
         *  attributes for each optionally specified beneficiary;
         *  if no beneficiaries are specified then sum over all;
         *  if no attributes are specified then sum over all;
         * @param {Array.<string>} beneficiaryNames - names of
         *  beneficiaries over whom to sum; sum over all if undefined
         * @param {Array.<string>} attributeNames - names of
         *  attributes over which to sum; sum over all if undefined
         */
        this.sumAttributePercentages = function(beneficiaryNames, attributeNames) {
          if (typeof(beneficiaryNames) === 'undefined') {
            beneficiaryNames = Object.keys(this.attributes);
          }
          sum = 0;
          for (var j = 0; j < beneficiaryNames.length; j++) {
            if (typeof(attributeNames) === 'undefined') {
              attributeArray = Object.keys(this.attributes[beneficiaryNames[j]]);
            } else {
              attributeArray = attributeNames;
            }
            for (var k = 0; k < attributeArray.length; k++) {
              sum += +this.attributes[beneficiaryNames[j]][attributeArray[k]].percentageOfBeneficiary;
            }
          }
        };

        /**
         * return {..., benName_i: percentageOfStakeholder_i, ...}
         *  for the named stakeholder
         */
        this.getEachBeneficiaryPercentage = function (stakeholderName) {
          var percentages = {};
          var beneficiaryNames = Object.keys(this.stakeholders[stakeholderName].beneficiaries);
          for (i = 0; i < beneficiaryNames.length; i++) {
            percentages[beneficiaryNames[i]] = this.stakeholders[stakeholderName].beneficiaries[beneficiaryNames[i]].percentageOfStakeholder
          }
          return percentages;
        };

        /**
         * return the sum of scores times stakeholder-score
         *  for each criterion
         * @param {string} stakeholders - stakeholder whose scores
         *  will be summed
         */
        this.scoresTimesScoresSum = function(stakeholder) {
          var criteria = Object.keys(this.scores);
          var sum = 0;
          for (var k = 0; k < criteria.length; k++) {
            if (typeof(this.stakeholders[stakeholder].scores[criteria[k]]) === 'undefined') {
              accessiblyNotify(stakeholder + ' has no score for ' + criteria[k]);
              continue;
            }
            sum += parseFloat(this.scores[criteria[k]]) * parseFloat(this.stakeholders[stakeholder].scores[criteria[k]]);
          }
          return sum;
        };

        /**
         * return the sum of beneficiary-scores for all stakeholders
         * @param {string} beneficiary - beneficiary whose
         *  scores are summed
         */
        this.beneficiaryScore = function(beneficiary) {
          var stakeholders = Object.keys(this.stakeholders);
          var numerator = 0;
          var denominator = 0;
          for (var i = 0; i < stakeholders.length; i++) {
            if (Object.keys(this.stakeholders[stakeholders[i]].beneficiaries).length) {
              var percentageOfStakeholder = parseFloat(this.stakeholders[stakeholders[i]].beneficiaries[beneficiary].percentageOfStakeholder);
              if (isNaN(percentageOfStakeholder)) {
                continue;
              }
              numerator += percentageOfStakeholder
              * parseFloat(this.scoresTimesScoresSum(stakeholders[i]));
            }
          }
          for (var i = 0; i < stakeholders.length; i++) {
            denominator += parseFloat(this.scoresTimesScoresSum(stakeholders[i]));
          }
          return numerator / denominator;
        };

        /** return current array of extant beneficiaries */
        this.extantBeneficiaries = function() {
          var extantStakeholders = Object.keys(this.stakeholders);
          var extantBeneficiaries = [];
          var stakeholderIndex;
          var beneficiaryIndex;
          var beneficiaries;
          for (stakeholderIndex = 0; stakeholderIndex < extantStakeholders.length; stakeholderIndex++) {
            beneficiaries = Object.keys(this.stakeholders[extantStakeholders[stakeholderIndex]].beneficiaries);
            for (beneficiaryIndex = 0; beneficiaryIndex < beneficiaries.length; beneficiaryIndex++) {
              if (extantBeneficiaries.indexOf(beneficiaries[beneficiaryIndex]) === -1
                  && this.stakeholders[extantStakeholders[stakeholderIndex]].beneficiaries[beneficiaries[beneficiaryIndex]].percentageOfStakeholder !== '') {
                extantBeneficiaries.push(beneficiaries[beneficiaryIndex]);
              }
            }
          }
          return extantBeneficiaries;
        };

        this.updateName = function(name) {
          this.projectName = name;
        };

        this.appName = 'FEGS Scoping Tool';
        this.version = '0.1.0';
        this.name = 'New Project';
        this.criteria = ['magnitude', 'influence', 'interest', 'urgency', 'proximity', 'economic-interest', 'rights', 'fairness', 'representation'];
        this.scores = this.makeCriteriaObject('1');
        this.stakeholders = {};
        this.attributes = {};
        this.fegsAttributes = ['Weather', 'Air', 'Wind', 'Atmospheric Phenomena', 'Sounds and Scents', 'Viewscapes', 'Open Space', 'Presence of the Environment', 'Land', 'Water', 'Soil', 'Substrate', 'Timber', 'Fiber', 'Natural Materials', 'Fauna', 'Fish', 'Flora', 'Fungi', 'Pollinators', 'Depredators and (Pest) Predators'];
        this.fegsBeneficiaries = ['Irrigators', 'CAFO Operators', 'Livestock grazers', 'Agricultural processors', 'Aquaculturalists', 'Farmers', 'Foresters', 'Food extractors', 'Timber/Fiber/Ornamental extractors', 'Industrial processors', 'Industrial dischargers', 'Energy generators', 'Resource-dependent businesses', 'Pharmaceutical/Food supplement suppliers', 'Fur/Hide trappers/hunters', 'Municipal drinking water plant operators', 'Wastewater treatment plant operators', 'Residential property owners', 'Military/Coast Guard', 'Transporters of goods', 'Transporters of people', 'Water subsisters', 'Food subsisters', 'Timber/Fiber/Fur/Hide subsisters', 'Building material subsisters', 'Experiencers/viewers', 'Food pickers/gatherers', 'Hunters', 'Anglers', 'Waders/Swimmers/Divers', 'Boaters', 'Spiritual and ceremonial participants', 'Artists', 'Students and educators', 'Researchers', 'People who care (existence)', 'People who care (option, bequest)'];
      };//////// END PROTOTYPE FEGScopingData ////////

      /** Prototype controller of communication between data and view */
      FEGSScopingController = function() {

        /** scrape data from the page and save the data */
        this.saveView = function() {
          var returnValue;
          if (window && window.process && window.process.type) { // true if in NODE's ELECTRON
            returnValue = fegsScopingController.saveJSON('data.json', fegsScopingView.scrapePage());
          } else { // else is selected if this instance appears to be running in the browser
            returnValue = this.downloadText('data.json', JSON.stringify(fegsScopingView.scrapePage()));
          }
          return returnValue;
        };

        /** save validated data */
        this.saveValidatedData = function() {
          this.saveJSON('data.json', fegsScopingData);
          fegsScopingView.indicateSaved();
        };

        /** update name of an instance of the app */
        this.updateName = function(name) {
          fegsScopingView.updateName(name);
          fegsScopingData.updateName(name);
          fegsScopingView.indicateUnsaved();
        };

        /** scrape state of page */
        this.scrapePage = function() {
          var scrapedValues;
          var scores = {};
          var beneficiaries = {};
          var attributes = {};
          var i;
          var j;
          for (i = 0; i < fegsScopingData.criteria.length; i++) { // save view-state of #table-scores
            scores[fegsScopingData.criteria[i] + '-score'] = document.getElementById(fegsScopingData.criteria[i] + '-score').value;
          }
          if (document.getElementById('table-beneficiaries').rows[0].cells.length > 2) { // scrape #table-beneficiaries conditioned upon whether table-beneficiaries is populated
            for (i = 0; i < fegsScopingData.fegsBeneficiaries.length; i++) { // loop through each row of the table
              if (+(document.getElementById('table-beneficiaries').rows[i + 1].cells.length) < 3) { // does the row have two th-elements?
                beneficiaries[fegsScopingData.fegsBeneficiaries[i]] = document.getElementById('table-beneficiaries').rows[i + 1].cells[1].firstChild.value; // scrape this beneficiary's value
              } else { // the row appears to have only one th as a label
                beneficiaries[fegsScopingData.fegsBeneficiaries[i]] = document.getElementById('table-beneficiaries').rows[i + 1].cells[2].firstChild.value; // scrape this beneficiary's value
              }
            }
          } else { // no beneficiaries are populated into #table-beneficiaries
            console.log('no attributes recorded from view');
          }
          for (i = 0; i < fegsScopingData.fegsBeneficiaries.length; i++) {
            attributes[fegsScopingData.fegsBeneficiaries[i]] = {};
            for (j = 0; j < fegsScopingData.fegsAttributes.length; j++) {
              attributes[fegsScopingData.fegsBeneficiaries[i]][fegsScopingData.fegsAttributes[j]] = tableAttributes.cellInputValue(tableAttributes.cell(fegsScopingData.fegsAttributes[j], fegsScopingData.fegsBeneficiaries[i]));
            }
          }
          /* //works in BROWSER
          document.getElementById('scrape-page').setAttribute('data-view-state', JSON.stringify({'scores': scores, 'beneficiaries': beneficiaries, 'attributes': attributes})); */
          scrapedValues = {'scores': scores, 'beneficiaries': beneficiaries, 'attributes': attributes};
          return scrapedValues;
        };

        /** save json to file; requires ELECTRON */
        this.saveJSON = function(savePath, jsonToBeSaved) {
          var fs = require('fs');
          var jsonText;
          if (typeof(jsonToBeSaved) !== 'string') {
            jsonText = JSON.stringify(jsonToBeSaved);
          } else {
            jsonText = jsonToBeSaved;
          }
          fs.writeFileSync(savePath, jsonText);
        };

        /** download given text to given filename; works in BROWSER */
        this.downloadText = function (filename, text) {
          var element = document.createElement('a');
          element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
          element.setAttribute('download', filename);
          element.style.display = 'none';
          document.body.appendChild(element);
          element.click();
          document.body.removeChild(element);
        }

        /** read data-model from disk; requires ELECTRON */
        this.readData = function(filename) {
          const fs = require('fs');
          if (typeof(filename) === 'undefined') {filename = 'data.json'}
          var importedData = fs.readFileSync(filename);
          importedData = JSON.parse(importedData);
          fegsScopingData = importedData;
        };

        this.restoreData = function() {
          this.readData();
          fegsScopingView.restoreView();
          fegsScopingView.indicateSaved();
        };

      };//////// END PROTOTYPE FEGSScopingController ////////

      /** sum all values in an object */
      var sum = function(obj) {
        var sum = 0;
        for(var el in obj) {
          if(obj.hasOwnProperty(el)) {
            sum += parseFloat(obj[el]);
          }
        }
        return sum;
      }

      /** pie chart */
      var initPieChart = {
        draw: function(config) {
          var me = this;
          var domEle = config.element;
          var data = config.data;
          var width = 400;
          var height = 480;
          var radius = Math.min(width, height) / 2;

          var legendRectSize = 18;
          var legendSpacing = 4;

          var color = d3.scaleOrdinal(criteriaColors); // Set the colors

          var pie = d3.pie().value(function(d) { return d.value; })(data);

          var arc = d3.arc()
                      .outerRadius(radius - 10)
                      .innerRadius(0);

          // Removed because we aren't using a label on the pie chart
          /*
          var labelArc = d3.arc()
                           .outerRadius(radius - 40)
                           .innerRadius(radius - 40);
          */

          var blankSlate = d3.select('#' + domEle + '>*').remove();

          var svg = d3.select("#" + domEle)
                      .append("svg")
                      .attr("width", width)
                      .attr("height", height)
                        .append("g")
                        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")"); // Moving the center point. 1/2 the width and 1/2 the height

          var g = svg.selectAll("arc")
                     .data(pie)
                     .enter().append("g")
                      .attr("class", "arc");

          g.append("path")
            .attr("d", arc)
            .style("fill", function(d) { return color(d.index);})
            .each(function(d) { this._current = d; }); // store the initial angles

          // Removed because we aren't using a label on the pie chart
          /*
          g.append("text")
            .attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
            .text(function(d) { return d.data.label;}) 
            .style("fill", "#fff")
            .each(function(d) { this._current = d; }); // store the initial angles;
          */

          //d3 legend not configured properly - just using HTML next to the inputs instead
          /*
           var legend = svg.selectAll('.legend')
              .data(color.domain())
              .enter()
              .append('g')
              .attr('class', 'legend')
              .attr('transform', function(d, i) {
                var height = legendRectSize + legendSpacing;
                var offset =  height * color.domain().length / 2;
                var horz = -2 * legendRectSize;
                var vert = i * height - offset;
                return 'translate(' + horz + ',' + vert + ')';
              });

            legend.append('rect')
              .attr('width', legendRectSize)
              .attr('height', legendRectSize)
              .style('fill', color)
              .style('stroke', color);

            legend.append('text')
              .attr('x', legendRectSize + legendSpacing)
              .attr('y', legendRectSize - legendSpacing)
              .text(function(d) { return d; });
            */

          //update
          function change() {
            var pie = d3.pie().sort(null)
              .value(function(d) { return d.value; })(data);
            path = d3.select("#" + domEle).selectAll("path").data(pie);
            path.transition().duration(500).attrTween("d", arcTween); // Smooth transition with arcTween
            // Removed because we aren't using a label on the pie chart
            //d3.selectAll("text").data(pie).transition().duration(500).attrTween("transform", labelArcTween); // Smooth transition with labelArcTween
          }

          d3.selectAll(".scoring input")
            .on("input", function() {
              // Add input validation.
              data = getJSON();
              // convert JSON data to fit scores data format
              var scores = {};
              for (var i = 0; i < data.length; i++) {
                scores[data[i].label.replace('-score', '')] = data[i].value;
              }
              // update FEGS scoping data with newest score data
              fegsScopingData.scores = scores;
              change();
              initStackedBarChart.draw({
                data: formatStakeholderData(),
                key: fegsScopingData.criteria,
                element: 'stakeholder-prioritization'
              });
              updateWeightingProgress();
              fegsScopingView.indicateUnsaved();
            });

          function arcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function(t) {
              return arc(i(t));
            };
          } 

          // Removed because we aren't using a label on the pie chart
          /*
          function labelArcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function(t) {
              return "translate(" + labelArc.centroid(i(t)) + ")";
            };
          }
          */
        }
      };

      /**
       * Get the data for the global scores and return them in a JSON object.
       * @function
       * @return {object} - A JSON object containing the criteria and their scores. 
       */ function getJSON() {
          var json = [];
          d3.selectAll('.scoring input').each(function() {
          json.push({
            label: this.id,
            value: this.value
          });
        });
        return json;
      }

      document.getElementById("stakeholder-group").addEventListener("keyup", function(event) {
        event.preventDefault();
        if (event.keyCode === 13) {
            document.getElementById("add-stakeholder").click();
        }
      });

      /**
       * Adds a stakeholder based on the input data
       * @function
       */
      function addStakeholder() {
        var weights = fegsScopingData.makeCriteriaObject({});
        var stakeholderGroupInput = document.getElementById('stakeholder-group');
        var stakeholderGroup = stakeholderGroupInput.value;
        stakeholderGroupInput.value = '';
        
        if (Object.keys(fegsScopingData.stakeholders).indexOf(stakeholderGroup) !== -1) { // if the stakeholder exists or is blank.
          accessiblyNotify('A stakeholder with this name already exists.');
          return;
        } else if (stakeholderGroup.trim() === "") {
          accessiblyNotify('Enter a valid stakeholder name.');
          return;
        }
        fegsScopingData.addStakeholder(stakeholderGroup, weights); // add the stakeholder to the model
        document.getElementById('set-stakeholder-values').style.display = "block";
        document.getElementById('stakeholder-list').style.display = "block";

        var stakeholderList = document.getElementById('stakeholder-list'); // create the stakeholder list
        var li = document.createElement('li');
        li.setAttribute('data-stakeholder', stakeholderGroup);
        li.appendChild(document.createTextNode(stakeholderGroup));

        var button = document.createElement('button');
        button.setAttribute('class', 'remove-stakeholder');
        button.setAttribute('aria-label', 'remove stakeholder');
        button.innerHTML = '&#215;';

        button.addEventListener("click", function() { // create listeners for the remove stakeholder button
          var stakeholder = this.parentNode.getAttribute('data-stakeholder');
          var elementsToRemove = document.querySelectorAll('[data-stakeholder="' + stakeholder + '"]');
          for (var i = 0, length = elementsToRemove.length; i < length; i++) {
            elementsToRemove[i].remove();
          }
          fegsScopingData.removeStakeholders([stakeholder]);
          updateStakeholderProgress();
          if (document.getElementById("stakeholder-list").children.length === 0) {
            document.getElementById('set-stakeholder-values').style.display = "none";
          }
        });

        li.appendChild(button);
        stakeholderList.appendChild(li); // append the button and li elements to the ul

        var lists = document.getElementsByClassName('stakeholder-value-list');
        for (var i = 0; i < lists.length; i++) { // Create the score inputs for the added stakeholder
          var ul = lists[i];
          var li = document.createElement('li');
          li.setAttribute('class', 'stakeholder-score-item');
          li.setAttribute('data-stakeholder', stakeholderGroup);
          li.appendChild(document.createTextNode(stakeholderGroup));

          var input = document.createElement('input');
          input.setAttribute('type', 'number');
          input.setAttribute('min', '0');
          input.setAttribute('max', '100');
          input.setAttribute('step', '1');
          input.setAttribute('class', 'stakeholder-score-input');
          input.setAttribute('id', stakeholderGroup + '-' + ul.getAttribute('data-criterion'));
          input.setAttribute('data-criterion', ul.getAttribute('data-criterion'));
          li.appendChild(input);
          ul.appendChild(li);
        }
        updateStakeholderProgress();
        fegsScopingView.indicateUnsaved();
      }

      function addStakeholderScores() {
        var stakeholdersToAdd = scrapeAddStakeholders();
        for (var stakeholder in stakeholdersToAdd) {
          fegsScopingData.addStakeholder(stakeholder, stakeholdersToAdd[stakeholder]);
          addRow('table-stakeholders', [stakeholder, stakeholdersToAdd[stakeholder]]); // table name and array of values to insert
        }
        document.getElementById('set-stakeholder-values').style.display = "none";
        document.getElementById('stakeholder-list').style.display = "none";
        clearStakeholderScores();
        initStackedBarChart.draw({
          data: formatStakeholderData(),
          key: fegsScopingData.criteria,
          element: 'stakeholder-prioritization'
        });
        updateSelectStakeholder('select-stakeholder-to-slice-into-beneficiaries');
        document.getElementById('select-stakeholder-to-slice-into-beneficiaries').onchange();
        updateStakeholderProgress();
        document.getElementById('stakeholder-table-container').style.display = "block";
        fegsScopingView.indicateUnsaved();
      }

      function clearStakeholderScores() {
        var items = document.getElementsByClassName('stakeholder-score-item');
        for (var i = items.length - 1; i >= 0;  i--) {
          items[i].parentNode.removeChild(items[i]);
        }

        var names = document.getElementById('stakeholder-list');
        for (var j = names.children.length - 1; j >= 0 ; j--) {
          names.removeChild(names.children[j]);
        }
      }

      /*
        Scrape the values from the stakeholder inputs
      */
      function scrapeAddStakeholders() {
        var stakeholdersToAdd = {};
        var stakeholderScoreInputs = document.getElementsByClassName('stakeholder-score-input');
        for (var i = 0; i < stakeholderScoreInputs.length; i++) {
          var stakeholder = stakeholderScoreInputs[i].parentNode.getAttribute('data-stakeholder');
          var criterion = stakeholderScoreInputs[i].getAttribute('data-criterion');
          if (!stakeholdersToAdd.hasOwnProperty(stakeholder)) {
            stakeholdersToAdd[stakeholder] = {};
            stakeholdersToAdd[stakeholder][criterion] = stakeholderScoreInputs[i].value;
          // } else if (criterion === "magnitude") {
          //   var sum = +stakeholdersToAdd[stakeholder][criterion] + +stakeholderScoreInputs[i].value;
          //   stakeholdersToAdd[stakeholder][criterion] = (sum >= 20 ? sum - 20 : 0) + '';
          } else {
            stakeholdersToAdd[stakeholder][criterion] = stakeholderScoreInputs[i].value;
          }
        }
        return stakeholdersToAdd;
      }

      function updateStakeholderProgress() {
        var stakeholderCount = Object.keys(fegsScopingData.stakeholders).length;
        if (stakeholderCount === 0) {
          document.getElementById('stakeholder-progress').innerHTML = "Add a stakeholder";
          return;
        }
        var completeCount = stakeholderCount;
        for (var stakeholder in fegsScopingData.stakeholders) {
          for (var criterion in fegsScopingData.stakeholders[stakeholder].scores) {
            var score = fegsScopingData.stakeholders[stakeholder].scores[criterion];
            if (score === "" || score > 100 || score < 0) {
              completeCount--;
              break;
            }
          }
        }
        document.getElementById('stakeholder-progress').innerHTML = completeCount + " of " + stakeholderCount + " stakeholders completed";
        updateBeneficiaryProgress();
      }

      function updateBeneficiaryProgress() {
        var stakeholderCount = Object.keys(fegsScopingData.stakeholders).length;
        if (stakeholderCount === 0) {
          document.getElementById('beneficiaries-progress').innerHTML = "Add a stakeholder";
          return;
        }
        var completeCount = stakeholderCount;
        for (var stakeholder in fegsScopingData.stakeholders) {
          if (!Object.keys(fegsScopingData.stakeholders[stakeholder].beneficiaries).length) {
            completeCount--;
          }
        }
        if (completeCount > 0) {
          var percentageSum = 0;
          var j, inputs, input;
          inputs = document.getElementsByClassName('beneficiary-percentage-of-stakeholder');
          for (j = 0; j < inputs.length; j++) {
            percentageSum += +inputs[j].value;
          }
          if (percentageSum < 99.95 || percentageSum > 100.05) { // inform user of unnormalized percentages
            completeCount--;
          }
        }
        document.getElementById('beneficiaries-progress').innerHTML = completeCount + " of " + stakeholderCount + " beneficiaries completed";
      }

      function updateWeightingProgress() {
        // Count the empty weights and display a progress counter
        var inputs = document.querySelectorAll('.scoring input');
        var emptyInputs = [];              
        for (var i = 0; i < inputs.length; i++) {
          if (!inputs[i].value) {
            emptyInputs.push(inputs[i]);
          }
        }
        document.getElementById('weighting-progress').innerHTML = inputs.length - emptyInputs.length + " of " + inputs.length + " criteria completed";
      }

      var formatStakeholderData = function() {
        var data = [];
        for (var stakeholderGroup in fegsScopingData.stakeholders) {
          var stakeholder = {};
          stakeholder.stakeholder = stakeholderGroup;
          for (var criterion in fegsScopingData.stakeholders[stakeholderGroup].scores) {
            stakeholder[criterion] = +fegsScopingData.stakeholders[stakeholderGroup].scores[criterion] * (+fegsScopingData.scores[criterion] / sum(fegsScopingData.scores));
          }
          data.push(stakeholder);
        }
        return data;
      };

      /**
       * Formats the row data
       * @function
       * @param {array} rowData - An array containing the data to display in the table.
       * @return {object} - An object holding the formatted row data.
       */
      function formatRowData(rowData) {
        var scores = {};
        scores[fegsScopingData.criteria[0]] = rowData[1];
        scores[fegsScopingData.criteria[1]] = rowData[2];
        scores[fegsScopingData.criteria[2]] = rowData[3];
        scores[fegsScopingData.criteria[3]] = rowData[4];
        scores[fegsScopingData.criteria[4]] = rowData[5];
        scores[fegsScopingData.criteria[5]] = rowData[6];
        scores[fegsScopingData.criteria[6]] = rowData[7];
        scores[fegsScopingData.criteria[7]] = rowData[8];
        scores[fegsScopingData.criteria[8]] = rowData[9];
        return scores;
      }

      /**
       * Gets the checked value of a specified name of ratio inputs.
       * @function
       * @param {string} name - The name of the radio buttons.
       * @return {string} - The value associated with the checked radio button.
       */
      function getCheckedValueByName(name) {
        var elements = document.getElementsByName(name);
        for (var i = 0, length = elements.length; i < length; i++) {
          if (elements[i].checked) {
            return elements[i].value;
          }
        }
      }

      /**
       * Adds a row containing the specified data to the table, with appropriate listeners.
       * @function
       * @param {string} tableID - The ID of the table element.
       * @param {array} rowData - An array containing the data to display in the table.
       */
      function addRow(tableID, rowData) {
        var tableRef = document.getElementById(tableID).getElementsByTagName('tbody')[0]; // Get a reference to the table
        var newRow = tableRef.insertRow(); // Insert a row in the table at row index 0

        var editButton = createButton('Edit', 'edit-button'); // Create Buttons
        var saveButton = createButton('Save', 'save-button');
        saveButton.setAttribute("aria-hidden", "true");
        var removeButton = createButton('Remove', 'remove-button');

        var newCell = newRow.insertCell(); // Insert a cell in the row to hold the buttons
        newCell.appendChild(editButton);
        newCell.appendChild(saveButton);
        newCell.appendChild(removeButton);

        removeButton.addEventListener("click", function() { // create listeners for the buttons
          var stakeholder = this.parentNode.nextSibling.innerHTML;
          fegsScopingData.removeStakeholders([stakeholder]);
          this.parentNode.parentNode.remove();
          removeOptionFromSelect('select-stakeholder-to-slice-into-beneficiaries', stakeholder);
          initStackedBarChart.draw({
            data: formatStakeholderData(),
            key: fegsScopingData.criteria,
            element: 'stakeholder-prioritization'
          });
          var stakeholderCount = Object.keys(fegsScopingData.stakeholders).length;
          if (stakeholderCount === 0) {
            document.getElementById('stakeholder-table-container').style.display = "none";
          }
        });

        editButton.addEventListener("click", function() {
          this.setAttribute("aria-hidden", "true"); // hide the edit button
          var row = this.parentNode.parentNode;
          row.getElementsByClassName('save-button')[0].removeAttribute('aria-hidden'); // show the save button
          var cells = row.cells;
          for (var i = 1, length = cells.length; i < length; i++) {
            var cell = cells[i];
            var text = cell.innerHTML;
            cell.innerHTML = '<input data-original-value="' + text + '" type="text" value="' + text + '"/>'; // create an input with the cell value
          }
        });

        saveButton.addEventListener("click", function() {
          this.setAttribute("aria-hidden", "true"); // hide the save button
          var row = this.parentNode.parentNode;
          row.getElementsByClassName('edit-button')[0].removeAttribute('aria-hidden'); // show the edit button
          var cells = row.cells;
          rowData = [];
          var originalStakeholderName;
          if (cells[1].firstElementChild.hasAttribute("data-original-value")) {
            originalStakeholderName = cells[1].firstElementChild.getAttribute("data-original-value");
          }
          for (var i = 1, length = cells.length; i < length; i++) {
            var cell = cells[i];
            rowData.push(cell.firstElementChild.value);
            cell.innerHTML = cell.firstElementChild.value; // set the value of the cell to the value of the child input of the cell
          }
          var scores = fegsScopingData.makeCriteriaObject(formatRowData(rowData));

          if (rowData[0] !== originalStakeholderName) {
            fegsScopingData.renameStakeholder(originalStakeholderName, rowData[0]);
          } else {
            fegsScopingData.addStakeholder(originalStakeholderName, scores);
          }
          fegsScopingData.stakeholders[rowData[0]].scores = scores;
          updateSelectStakeholder('select-stakeholder-to-slice-into-beneficiaries'); // update select-box that its entries have changed
          initStackedBarChart.draw({
            data: formatStakeholderData(),
            key: fegsScopingData.criteria,
            element: 'stakeholder-prioritization'
          });
        });
        var newCell = newRow.insertCell(); // Insert a cell in the row at index 0
        var newText = document.createTextNode(rowData[0]); // Append a text node to the cell
        newCell.appendChild(newText);
        for (var i = 0, length = fegsScopingData.criteria.length; i < length; i++) {
          var newCell = newRow.insertCell(); // Insert a cell in the row at index 0
          var newText = document.createTextNode(rowData[1][fegsScopingData.criteria[i]]); // Append a text node to the cell
          newCell.id = rowData[0] + '-' + fegsScopingData.criteria[i];
          newCell.appendChild(newText);
        }
      }

      /**
       * Creates an HTML button element with the text and class specified.
       * @function
       * @param {string} text - The text to be displayed on the button.
       * @param {string} className - The class to assign to the button.
       * @return {Element} - The HTML button element.
       */
      function createButton(text, className) {
        var button = document.createElement("button");
        button.innerHTML = text;
        button.className = className;
        return button;
      }

      /**
       * Toggles the visibility of the spefied element.
       * @function
       * @param {string} id - The ID of the element to toggle visiibility.
       */
      function toggleVisibility(id) {
        var element = document.getElementById(id);
        if (element.style.display === "block") {
          element.style.display = "none";
        } else {
          element.style.display = "block";
        }
      }

      /** stacked bar-chart */
      var initStackedBarChart = {
        draw: function(config) {
          var me = this;
          var domEle = config.element;
          var stackKey = config.key;
          var data = config.data;
          var margin = {top: 20, right: 20, bottom: 30, left: 50};
          var width = 550 - margin.left - margin.right;
          var height = 400 - margin.top - margin.bottom;
          var xScale = d3.scaleBand().range([0, width]).padding(0.1);
          var yScale = d3.scaleLinear().range([height, 0]);
          var color = d3.scaleOrdinal(criteriaColors);
          var xAxis = d3.axisBottom(xScale);
          var yAxis =  d3.axisLeft(yScale);
          var container = d3.select("#"+domEle);

          container.selectAll('svg').remove();

          if (data.length === 0) {
            return; // if there's no data to display don't display anything!
          }
          var svg = container.append("svg")
                             .attr("width", width + margin.left + margin.right)
                             .attr("height", height + margin.top+10 + margin.bottom+10)
                             .append("g")
                             .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          var stack = d3.stack()
                        .keys(stackKey)
                        .order(d3.stackOrderNone)
                        .offset(d3.stackOffsetNone);

          var layers = stack(data);
          data.sort(function(a, b) { return b.total - a.total; });
          xScale.domain(data.map(function(d) { return d.stakeholder; }));
          yScale.domain([0, d3.max(layers[layers.length - 1], function(d) { return d[0] + d[1]; }) ]).nice();

          var layer = svg.selectAll(".layer")
                         .data(layers)
                         .enter().append("g")
                         .attr("class", "layer")
                         .style("fill", function(d, i) { return color(i); });

          layer.selectAll("rect")
               .data(function(d) { return d; })
             .enter().append("rect")
               .attr('class', 'bar')
               .attr("x", function(d) { return xScale(d.data.stakeholder); })
               .attr("y", function(d) {
                 return yScale(d[1]);
               })
               .attr("height", function(d) {
                 return yScale(d[0]) - yScale(d[1]);
               })
               .attr("width", xScale.bandwidth())
               .on('click', function(d, i) {
                 d3.selectAll('.bar').classed('selected', false);
                 d3.select(this).classed('selected', true);
               });

          svg.append("g")
             .attr("class", "axis axis--x")
             .attr("transform", "translate(0," + (height+5) + ")")
             .call(xAxis);

          svg.append("g")
             .attr("class", "axis axis--y")
             .attr("transform", "translate(0,0)")
             .call(yAxis);
          return container;
        }
      };

      var getStakeholderPrioritizationsFromTable = function() {
        var table = document.getElementById('table-stakeholders');
        var tbody = table.getElementsByTagName('tbody')[0]; // get all rows of body
        var rows = tbody.getElementsByTagName('tr');
        var data = [];
        if (rows.length > 0) {
          for (var i = 0; i < rows.length; i++) {
            data[i] = {};
            cells = rows[i].getElementsByTagName('td');
            data[i]['stakeholder'] = cells[1].innerText;
            for (var j = 2; j < cells.length; j++) {
              data[i][fegsScopingData.criteria[j - 2]] = cells[j].innerText;
            }
          }
        }
        return data; // return data as array of objects with criteria as keys
      };

      /**
       * Add a column of data to the table with id tableId.
       * @param {string} tableId - id of table
       * @param {string} columnName - name of column to use as header
       * @param {string} dataArray - array whose elements will populate
       *  the columns where column i + 1 gets ith element of the array
       */
      var addTableColumn = function(tableId, columnName, dataArray) {
        var table = document.getElementById(tableId);
        table.tHead.rows[0].insertCell(-1).outerHTML = '<th>' + columnName + '<th>';
        var rows = table.tBodies[0].rows;
        for (i = 0; i < rows.length; i++) {
          var cell = rows[i].insertCell(-1);
          cell.innerHTML = dataArray[i];
        }
      };

      /**
       * Returns the cell of the table by given (x;y) coordinates considering
       *  colSpan and rowSpan of the cells.
       * @param {HTMLElement} table - HTML table
       * @param {number} x - X position in table matrix
       * @param {number} y - Y position in table matrix
       * @returns {HTMLElement|null}
       */
      var getTableCell = function (table, x, y) {
        var m = [], row, cell, xx, tx, ty, xxx, yyy;
        for (yyy = 0; yyy < table.rows.length; yyy++) {
          row = table.rows[yyy];
          for (xxx = 0; xxx < row.cells.length; xxx++) {
            cell = row.cells[xxx];
            xx = xxx;
            for (; m[yyy] && m[yyy][xx]; ++xx) {}
            for (tx = xx; tx < xx + cell.colSpan; ++tx) {
              for (ty = yyy; ty < yyy + cell.rowSpan; ++ty) {
                if (!m[ty])
                  m[ty] = [];
                m[ty][tx] = true;
              }
            }
            if (xx <= x
                && x < xx + cell.colSpan
                && yyy <= y
                && y < yyy + cell.rowSpan)
                return cell;
          }
        }
        return null;
      };

      /** Add an option with given value and text to a given select-box. */
      var addOption = function(selectId, optionText, optionValue) {
        var select = document.getElementById(selectId);
        var optionToAdd = document.createElement('option');
        optionToAdd.innerText = optionText;
        optionToAdd.value = optionValue;
        select.add(optionToAdd);
      };

      /** update select-element's options */
      /** DUPE of updateSelectStakeholder unless modified **/
      updateSelect = function(selectId, options) {
        var options = Object.keys(fegsScopingData.stakeholders);
        var oldOptions = document.querySelectorAll('#' + selectId + ' option:not([disabled="disabled"])');
        var i;
        for (i = 0; i < oldOptions.length; i++) {
          oldOptions[i].parentNode.removeChild(oldOptions[i]);
        }
        for (i = 0; i < options.length; i++) {
          addOption(selectId, options[i], options[i]);
        }
        selectStakeholderToSlice();
      };

      /**
       * Populate a stakeholder's beneficiary-percentages into the view.
       *
       * Put each value in a text-input.
       * Validate data-entry by notifying when sum of inputs > 100.
       */
      var selectStakeholderToSlice = function() {
        var table = document.getElementById('table-beneficiaries');
        var select = document.getElementById('select-stakeholder-to-slice-into-beneficiaries');
        var stakeholderName = select.value;
        var tBody = table.tBodies[0];
        var iRow, cell, input, cellText, rowspan, numberOfBeneficiaryColumn;
        var beneficiaryPercentageOfStakeholderInputValidator = function() { // validate sum of percentages is 100 +- 0.05 then save
          var percentageSum = 0;
          var j, inputs, input;
          inputs = document.getElementsByClassName('beneficiary-percentage-of-stakeholder');
          for (j = 0; j < inputs.length; j++) {
            if (isNaN(parseFloat(inputs[j].value))) {
              inputs[j].parentElement.style = 'background-color: red';
            }
            percentageSum += +inputs[j].value;
          }
          if (percentageSum < 99.95 || percentageSum > 100.05) { // inform user of unnormalized percentages
            accessiblyNotify('Percentages must sum to 100. The current sum is ' + percentageSum);
            for (j = 0; j < inputs.length; j++) {
              inputs[j].parentElement.style = 'background-color: red';
            }
          } else { // update data with valid input
            clearNotices();
            for (j = 0; j < inputs.length; j++) {
              inputs[j].parentElement.style = 'background-color: initial';
              beneficiaryNameForInput = inputs[j].parentElement.parentElement.cells[inputs[j].parentElement.cellIndex - 1].innerText;
              if (!fegsScopingData.stakeholders[stakeholderName].beneficiaries
                  || !fegsScopingData.stakeholders[stakeholderName].beneficiaries[beneficiaryNameForInput]) {
                fegsScopingData.addBeneficiary(stakeholderName, beneficiaryNameForInput, inputs[j].value);
              }
              fegsScopingData.stakeholders[stakeholderName]
                             .beneficiaries[beneficiaryNameForInput]
                             .percentageOfStakeholder = inputs[j].value;
              fegsScopingView.indicateUnsaved();
            }
          displayBeneficiaryScores(); // update #table-beneficiary-score
          }
          updateBeneficiaryProgress();
          tableAttributes.showOnlyTheseColumns(fegsScopingData.extantBeneficiaries());
        };
        for (i = tBody.rows[0].cells.length - 1; i > 1; i--) { // remove all data columns
          removeLastColumnFromTable(table.id);
        }
        if (select.selectedIndex === 0) { // default selection => do nothing further
          return;
        }
        addTableColumn(table.id, stakeholderName, fegsScopingData.fegsBeneficiaries); // add a column to house the data
        for (iRow = 0; iRow < tBody.rows.length; iRow++) {
          cell = tBody.rows[iRow].cells[tBody.rows[iRow].cells.length - 1];
          if (!fegsScopingData.stakeholders[stakeholderName]
              || !('beneficiaries' in fegsScopingData.stakeholders[stakeholderName])) {
            cell.innerHTML = '';
            input = document.createElement('input');
            input.type = 'number';
            input.className = 'beneficiary-percentage-of-stakeholder';
            cell.appendChild(input);
            input.onchange = beneficiaryPercentageOfStakeholderInputValidator;
            continue;
          }
          if (tBody.rows[iRow].cells[0].getAttribute('rowspan') === null) {
            numberOfBeneficiaryColumn = 0;
          } else {
            numberOfBeneficiaryColumn = 1;
          }
          beneficiaryName = tBody.rows[iRow].cells[numberOfBeneficiaryColumn].innerText;
          cell.innerHTML = '';
          input = document.createElement('input');
          input.type = 'number';
          input.className = 'beneficiary-percentage-of-stakeholder';
          if (fegsScopingData.stakeholders[stakeholderName].beneficiaries[beneficiaryName]
              && fegsScopingData.stakeholders[stakeholderName].beneficiaries[beneficiaryName].hasOwnProperty('percentageOfStakeholder')) {
            input.value = fegsScopingData.stakeholders[stakeholderName]
                                      .beneficiaries[beneficiaryName]
                                      .percentageOfStakeholder;
          }
          input.onchange = beneficiaryPercentageOfStakeholderInputValidator; // save valid input
          cell.appendChild(input);
          tableAttributes.showOnlyTheseColumns(fegsScopingData.extantBeneficiaries());
        }
        updateBeneficiaryProgress();
      };

      /**
       * Populate test data to verify calculations
       * Access data as fegsScopingData.stakeholders['foo']
       *                               .beneficiaries['Irrigators']
       *                               .attributes['Weather']
       */
      var prepopulatedData = function() {
        var literal = {
          'stakeholders': {
            'Residents': {
              'scores': {
                'magnitude': '40',
                'influence': '100',
                'interest': '25',
                'urgency': '0',
                'proximity': '75',
                'economic-interest': '100',
                'rights': '100',
                'fairness': '100',
                'representation': '100'
              },
              'beneficiaries': {
                'Farmers': {
                  'percentageOfStakeholder': '20',
                  'attributes': {
                    'Weather': '15',
                    'Air': '5',
                    'Soil': '15',
                    'Water': '25',
                    'Fungi': '25',
                    'Polinators': '10',
                    'Depredators and (Pest) Predators': '5'
                  }
                },
                'Timber/Fiber/Ornamental extractors': {'percentageOfStakeholder': '25'},
                'Military/Coast guard': {'percentageOfStakeholder': '2'},
                'Water subsisters': {'percentageOfStakeholder': '3'},
                'Students and educators': {'percentageOfStakeholder': '30'},
                'People who care (existence)': {'percentageOfStakeholder': '10'},
                'People who care (option, bequest)': {'percentageOfStakeholder': '10'}
              },
            },
            'Timber Industry': {
              'scores': {
                'magnitude': '60',
                'influence': '50',
                'interest': '75',
                'urgency': '60',
                'proximity': '100',
                'economic-interest': '100',
                'rights': '60',
                'fairness': '0',
                'representation': '0'
              },
              'beneficiaries': {
                'Timber/Fiber/Ornamental extractors': {'percentageOfStakeholder': '100'}
              }
            },
            'Fishing and Crabbing Industry': {
              'scores': {
                'magnitude': '60',
                'influence': '50',
                'interest': '75',
                'urgency': '60',
                'proximity': '100',
                'economic-interest': '100',
                'rights': '60',
                'fairness': '0',
                'representation': '0'
              },
              'beneficiaries': {
                'Food extractors': {'percentageOfStakeholder': '100'}
              }
            }
          },
          'attributes': {
            'Farmers': {
              'Weather': '15',
              'Air': '5',
              'Water': '15',
              'Soil': '25',
              'Fungi': '25',
              'Pollinators': '10'
            },
            'Food extractors': {
              'Fauna': '100'
            },
            'Timber/Fiber/Ornamental extractors': {
              'Flora': '100'
            },
            'Military/Coast Guard': {
              'Water': '100'
            },
            'Water subsisters': {
              'Water': '100'
            },
            'Students and educators': {
              'Sounds and Scents': '10',
              'Viewscapes': '50',
              'Open Space': '10',
              'Presence of the Environment': '30',
            },
            'People who care (existence)': {
              'Sounds and Scents': '10',
              'Viewscapes': '50',
              'Open Space': '10',
              'Presence of the Environment': '30',
            },
            'People who care (option, bequest)': {
              'Sounds and Scents': '10',
              'Viewscapes': '50',
              'Open Space': '10',
              'Presence of the Environment': '30',
            },
          }
        };
        var data = new FEGSScopingData();
        data.attributes = JSON.parse(JSON.stringify(literal.attributes));
        data.stakeholders = JSON.parse(JSON.stringify(literal.stakeholders));
        return data;
      };

      /**
       * Populate sample data into app for development.
       * Access data as fegsScopingData.stakeholders['foo']
       *                               .beneficiaries['Irrigators']
       *                               .attributes['Weather']
       */
      var populateDevData = function(stakeholderNames) {
        if (typeof(stakeholderNames) === 'undefined') {
          var stakeholderNames = ['foo', 'bar', 'baz', 'qux'];
        }
        for (var i = 0; i < stakeholderNames.length; i++){
          var stakeholderName = stakeholderNames[i];
          var beneficiarySlices = [];
          var iBen, iAttr;
          var benSum = 0;
          var sliceSum = 0;
          var attrSum = 0;
          var normalizedSlice;
          var unnormalizedPercentages = [];
          var AttributesObject = {};
          fegsScopingData.addStakeholder(stakeholderName, fegsScopingData.makeCriteriaObject());
          for (iBen = 0; iBen < fegsBeneficiaries.length; iBen++) {
            beneficiarySlices.push(Math.random());
            benSum += beneficiarySlices[iBen];
          }
          for (iBen = 0; iBen < fegsBeneficiaries.length; iBen++) {
            normalizedSlice = parseFloat((beneficiarySlices[iBen] * benSum**-1 * 100).toFixed(2));
            fegsScopingData.addBeneficiary(stakeholderName, fegsBeneficiaries[iBen], normalizedSlice);
            attrSum = 0;
            for (iAttr = 0; iAttr < fegsScopingData.fegsAttributes.length; iAttr++) {
              AttributesObject[fegsScopingData.fegsAttributes[iAttr]] = Math.random();
              attrSum += AttributesObject[fegsScopingData.fegsAttributes[iAttr]];
            }
            for (iAttr = 0; iAttr < fegsScopingData.fegsAttributes.length; iAttr++) {
              AttributesObject[fegsScopingData.fegsAttributes[iAttr]] = AttributesObject[fegsScopingData.fegsAttributes[iAttr]] * attrSum**-1 * 100;
            }
            fegsScopingData.addAttributes(stakeholderName, fegsBeneficiaries[iBen], AttributesObject);
          }
          for (iBen = 0; iBen < fegsBeneficiaries.length - 1; iBen++) {
            normalizedSlice = parseFloat((beneficiarySlices[iBen] * benSum**-1 * 100).toFixed(2));
            sliceSum += normalizedSlice;
            fegsScopingData.stakeholders[stakeholderName]
                           .beneficiaries[fegsBeneficiaries[iBen]]
                           .percentageOfStakeholder = normalizedSlice;
          }
            fegsScopingData.stakeholders[stakeholderName]
                           .beneficiaries[fegsBeneficiaries[fegsBeneficiaries.length - 1]]
                           .percentageOfStakeholder = (100 - sliceSum).toFixed(2);
        };
        return fegsScopingData;
      };

      var testy = function() {
        var select = document.getElementById('select-stakeholder-to-slice-into-beneficiaries');
        var stakeholdersArray;
        populateDevData();
        stakeholdersArray = Object.keys(fegsScopingData.stakeholders);
        for (var i = 0; i < stakeholdersArray.length; i++) {
          addOption('select-stakeholder-to-slice-into-beneficiaries', stakeholdersArray[i], stakeholdersArray[i]);
        }
        select.selectedIndex = 1;
        selectStakeholderToSlice();
      };

      /** clean trailing empty cells from each row then remove last cell from each row */
      var removeLastColumnFromTable = function(tableId) {
        table = document.getElementById(tableId);
        for (var i = 0; i < table.rows.length; i++) {
          for (var j = 0; j < table.rows[i].cells.length; j++) {
            if (table.rows[i].cells[table.rows[i].cells.length - 1].innerHTML.trim() === '') {
              table.rows[i].cells[table.rows[i].cells.length - 1].remove();// trim blank trailing cells
            }
          }
          table.rows[i].cells[table.rows[i].cells.length - 1].remove();// remove leftmost cell of data
        }
      };

      /** remove options with text of optionText from selectid */
      var removeOptionFromSelect = function(selectId, optionText) {
        select = document.getElementById(selectId);
        if (select.options[select.selectedIndex].text === optionText) {// is the option to be removed selected?
          select.selectedIndex = 0;// if selected => select default option
        }
        for (var i = 0; i < select.options.length; i++) {// remove option
          if (optionText === select.options[i].text) {
            select.options[i].remove();
          }
        }
        select.onchange(); // fire select's onchange callback
      };

      /** refresh select-box from data */
      var updateSelectStakeholder = function(selectId) {
        var i;
        var select = document.getElementById(selectId);
        var stakeholderNames = Object.keys(fegsScopingData.stakeholders);
        for (i = 1; i < select.options.length; i++) { // remove all options
          select.options[i].remove();
        }
        for (i = 0; i < stakeholderNames.length; i++) { // add option for each stakeholder
          addOption(selectId, stakeholderNames[i], stakeholderNames[i]);
        }
        selectStakeholderToSlice();
      };

      /** return HTMLElement of accessible notice of text */
      var accessiblyNotify = function(text) {
        var notices = document.getElementsByClassName('accessible-notification');
        var notice = document.createElement('div');
        var textNode = document.createTextNode(text);
        clearNotices();
        notice.appendChild(textNode);
        notice.style.position = 'fixed';
        notice.style.bottom = '0';
        notice.style.padding = '.5em';
        notice.style['background-color'] = 'pink';
        notice.setAttribute('aria-live', 'polite');
        notice.addEventListener('click', function() {this.remove()});
        notice.className = 'accessible-notification';
        document.getElementsByTagName('body')[0].appendChild(notice);
        return notice;
      };

      /** clear all notices */
      var clearNotices = function() {
        var notices = document.getElementsByClassName('accessible-notification');
        for (var i = 0; i < notices.length; i++) {
          notices[i].remove();
        }
      };

      var tablesome = function(columnNames, rowNames) {
        var mapString = function(inputString) {
          return inputString.toLocaleLowerCase().replace(/[^a-zA-Z0-9]$/, '').replace(/[ -/(]+/g, '-');
        };
        var mapper = function(arrayOfNames) {
          var map = {};
          for (var i = 0; i < arrayOfNames; i++) {
            map[arrayOfNames[i]] = {
              'id': mapString(columnNames[i]),
              'number': i,
            }
          }
          return map;
        };
        if (typeof(columnNames) !== 'undefined') {
          columnMap = mapper(columnNames); 
        }
        if (typeof(rowNames) !== 'undefined') {
          rowMap = mapper(rowNames); 
        }
        console.log('invoked tablesome()');
        return [columnMap, rowMap];
      };

      /** exemplify testing to a spec on the function that
       *   digests data to cleanse ugly characters
       */
      var tablesomeSpec = function(tablesome) { // a spec is a set of tests that define an API
        // sanitize arrays in url-friendly ways
        console.log('expecting', 'foo-bar-baz-qux');
        console.log("tablesome(['Foo - Bar/Baz(Qux)'], ['Foo - Bar/Baz(Qux)']):");
        console.log(tablesome(['Foo - Bar/Baz(Qux)'], ['Foo - Bar/Baz(Qux)']));
        return tablesome(['Foo- Bar / Baz(Qux )'], ['Foo - Bar/Baz (Qux)']) === [['foo-bar-baz-qux'], ['foo-bar-baz-qux']]; // should do something like array.replace(/\s*[-/\)\(]*\s*/, '-')
      };

      /**
       * interface cells indexed by row- and column-headers
       * @param {string} tableId - id of table to interface
       * @param {string[]} rowHeaders - headers of rows
       * @param {string[]} columnHeaders - headers of columns
       * @param {number} rowOffset - offset for tHead
       * @param {number} columnOffset - offset for header in row
       * @property {function} cell - return the HTMLElemtent of
       *  the cell specified by its row-header and column-header
       * @property {function} test - test the arrays of column-
       *  and row-headers against the table's headers
       */
      var Table = function(tableId, rowHeaders, columnHeaders, rowOffset, columnOffset) {
        this.id = tableId;
        this.rowHeaders = rowHeaders;
        this.columnHeaders = columnHeaders;
        this.rowOffset = rowOffset;
        this.columnOffset = columnOffset;
        this.table = document.getElementById(tableId);
        this.hiddenClassName = 'display-none';
        this.spannedHeaders = this.table.rows[0].cells
        this.colSpanOriginalValuePropertyName = 'data-colspan-original-value';
        this.cols = this.table.querySelectorAll('col');
        this.colCells = this.table.rows[0].cells;

        /** store an element's initial span in a uniformly named property of the element */
        this.storeInitialSpanOfCols = function storeInitialSpanOfCols() {
          var iCol;
          for (iCol = 0; iCol < this.cols.length; iCol++) {
            this.cols[iCol].setAttribute(this.colSpanOriginalValuePropertyName, this.cols[iCol].span);
          }
        };

        /** return the specified cell */
        this.cell = function(rowHeader, columnHeader) {
          var iRow = rowHeaders.indexOf(rowHeader) + this.rowOffset;
          var iColumn = columnHeaders.indexOf(columnHeader) + this.columnOffset;
          return this.table.rows[iRow].cells[iColumn];
        };

        /** test the table's construction */
        this.test = function() {
          var rowHeaderColumnNumber = 0;
          var columnHeaderRowNumber = 1;
          var errors = [];
          var i;
          for (i = 0; i < rowHeaders.length; i++) { // test rowHeaders
            if (rowHeaders[i] !== this.table.rows[i + rowOffset].cells[rowHeaderColumnNumber].innerText) {
              errors.push(new Error('rowHeaders mismatch: ' + rowHeaders[i] + ' does not match ' + this.table.rows[i + rowOffset].cells[rowHeaderColumnNumber].innerText));
            }
          }
          for (i = 0; i < columnHeaders.length; i++) { // test columnHeaders
            if (columnHeaders[i] !== this.table.rows[columnHeaderRowNumber].cells[columnOffset + i].innerText) {
              errors.push(new Error('columnHeaders mismatch: ' + columnHeaders[i] + ' does not match ' + this.table.rows[columnHeaderRowNumber].cells[columnOffset + i].innerText));
            }
          }
        };

        /** return table's cells in an array of arrays */
        this.cells = function() {
          var cells = [];
          for (i = 0; i < this.table.rows.length; i++) {
            if (typeof(cells[i]) === 'undefined') {
              cells[i] = [];
            }
            for (j = 0; j < this.table.rows[i]; j++) {
              cells[i][j] = this.table.rows[i].cells[j];
            }
          }
          return cells;
        };

        /**
         * get or set value of the input in the supplied cell
         * @param {td or th object} cell - supplied cell containing an input-element
         * @param {string} setterValue - specifies the value to set the input to when present
         */
        this.cellInputValue = function(cell, setterValue) {// setterValue is optional parameter to make this a setter
          if (typeof(setterValue) === 'undefined') {
            return cell.getElementsByTagName('input')[0].value; 
          } else { // if setterValue is present then set the input's value to setterValue
            cell.getElementsByTagName('input')[0].value = setterValue;
          }
        };

        /** get index of indicated column */
        this.getColumnIndex = function(columnIndicator) {
          if (isNaN(columnIndicator)) { // assume the argument is a heading-string if coerced into NaN
            if (this.columnHeaders.indexOf(columnIndicator) === -1) {
              return new Error('columnIndicator not found: ' + columnIndicator);
            }
            return this.columnHeaders.indexOf(columnIndicator) + this.columnOffset;
          } else { // assume a numerical index was supplied if not coerced to NaN
            return columnIndicator;
          }
        };

        /** true if the indicated column is hidden else false */
        this.isHidden = function(columnIndicator) {
          return this.table.rows[1].cells[this.getColumnIndex(columnIndicator)].classList.contains(this.hiddenClassName);
        };

        /** true if the indicated col is hidden else false */
        this.isColHidden = function(colIndicator) {
          var colIndex;
          if (+colIndicator === NaN) {
            colIndex = this.cols.indexOf(colIndicator);
          } else {
            colIndex = colIndicator;
          }
          return this.cols[colIndex].classList.contains(this.hiddenClassName);
        };

        /** get index of col containing the indicated column */
        this.getColIndex = function(columnIndicator) {
          var columnIndex = this.getColumnIndex(columnIndicator);
          var currentColOriginalSpan;
          var colIndex = 0;
          var colSpanIndex = 0;
          for (colIndex  = 0; colIndex < this.cols.length; colIndex++) {
            currentColOriginalSpan = parseFloat(this.cols[colIndex].getAttribute(this.colSpanOriginalValuePropertyName));
            if (colSpanIndex + currentColOriginalSpan > columnIndex) {
              return colIndex; // colIndex was the index of the col containing the indicated column
            } else {
              colSpanIndex += currentColOriginalSpan;
            }
          }
        };

        /** get name of indicated column */
        this.getColumnName = function(columnIndicator) {
          var columnIndex = this.getColumnIndex(columnIndicator);
          return this.table.rows[rowOffset - 1].cells[columnIndex].innerText;
        };

        /** hide columns up to that indicated */
        this.hideColumnsUpTo = function(columnIndicator) {
          var targetColumnIndex = this.getColumnIndex(columnIndicator);
          var currentColumnIndex;
          for (currentColumnIndex = columnOffset; currentColumnIndex < targetColumnIndex; currentColumnIndex++) {
            this.hideColumn(currentColumnIndex);
          }
        };

        /** hide indicated column */
        this.hideColumn = function(columnIndicator) {
          var rowIndex;
          var columnIndex = this.getColumnIndex(columnIndicator);
          var colIndex = this.getColIndex(columnIndex);
          if (this.isHidden(columnIndex)) {return;}
          if (this.cols[colIndex].span === 1) { // hide col and its labelling headers if this is last column
            this.cols[colIndex].classList.add(this.hiddenClassName);
            this.colCells[colIndex].classList.add(this.hiddenClassName);
          } else { // decrement span and colspan
            this.cols[colIndex].span -= 1;
            this.colCells[colIndex].colSpan -= 1;
          }
          for (rowIndex = 1; rowIndex < this.table.rows.length; rowIndex++) {
            this.table.rows[rowIndex].cells[columnIndex].classList.add(this.hiddenClassName);
          }
        };

        /** show indicated column */
        this.showColumn = function(columnIndicator) {
          var rowIndex;
          var columnIndex = this.getColumnIndex(columnIndicator);
          var colIndex = this.getColIndex(columnIndex);
          if (!this.isHidden(columnIndex)) { // do nothing if already shown
            return;
          }
          if (!this.isColHidden(colIndex)) { // increment span and colspan
            this.cols[colIndex].span += 1;
            this.colCells[colIndex].colSpan += 1;
          }
          if (this.cols[colIndex].span === 1) { // show col and its labelling headers if this is the first visible column in col
            this.cols[colIndex].classList.remove(this.hiddenClassName);
            this.colCells[colIndex].classList.remove(this.hiddenClassName);
          }
          for (rowIndex = 1; rowIndex < this.table.rows.length; rowIndex++) {
            this.table.rows[rowIndex].cells[columnIndex].classList.remove(this.hiddenClassName);
          }
        };

        /** show only specified columns */
        this.showOnlyTheseColumns = function(columnIndicators) {
          columnIndicators = (typeof columnIndicators !== 'undefined') ?  columnIndicators : [];
          var i;
          var columnIndex;
          for (i = 1; i < this.table.rows[1].cells.length; i++) {
            this.hideColumn(i);
          }
          for (i = 0; i < columnIndicators.length; i++) {
            columnIndex = this.getColumnIndex(columnIndicators[i]);
            this.showColumn(columnIndex);
          }
        };

        this.hideRow = function(rowIndicator) {
          //TODO fill in stub s.t. rowIndicator can be a numerical index or a header-name
        };

        this.showRow = function(rowIndicator) {
          //TODO fill in stub s.t. rowIndicator can be a numerical index or a header-name
        };

        ////////////////// Table'S PROCESS ////////////////////
        this.storeInitialSpanOfCols();
        var cell;
        for (i = 0; i < this.table.rows.length; i++) {
          for (j = 0; j < this.table.rows[i].cells.length; j++) {
            cell = this.table.rows[i].cells[j];
            if (cell.colSpan > 1) {
              cell.setAttribute(this.colSpanOriginalValuePropertyName, cell.colSpan);
            }
          }
        }
      };////// END PROTOTYPE NAMED Table ////////////

      /** instantiate a Table() for #table-attributes; perform specialized initializations */
      var tableAttributesCreator = function(tableId) {
        var rowOffset = 2; // introduce fragility by duplicating initializion via literal or break the callback's encapsulation?
        var columnOffset = 1; // introduce fragility by duplicating initializion via literal or break the callback's encapsulation?
        var rowNames = fegsScopingData.fegsAttributes;
        var columnNames = fegsScopingData.fegsBeneficiaries;
        var table = new Table(tableId, rowNames, columnNames, rowOffset, columnOffset);
        var cell;
        var validateAndSaveData = function() {
          var columnIndex = this.parentElement.cellIndex;
          var beneficiaryName = fegsScopingData.fegsBeneficiaries[columnIndex - columnOffset];
          var allBlank = true;
          var attributesObject = {};
          var sum = 0; // sum all cells to see if sum is correctly normalized
          var rows = this.parentElement.parentElement.parentElement.rows;
          var rowIndex;
          var input;
          if (this.value < 0 || this.value > 100) { // value is invalid after change
            for (i = 0; i < rows.length; i++) {
              rows[i].cells[columnIndex].classList.remove('invalid-text-input');
            }
            this.parentElement.classList.add('invalid-text-input');
            accessiblyNotify('Attribute ' + rows[this.parentElement.parentElement.rowIndex].cells[0].innerText + ' was input as ' + this.value + ' percent of beneficiary-group ' + document.getElementById('table-attributes').rows[1].cells[this.parentElement.cellIndex].innerText + '. Percentages must be between 0 and 100.');
          } else { // individual input is valid
            for (i = 0; i < rows.length - 1; i++) { // loop through values in column
              if (allBlank === true && rows[i].cells[columnIndex].getElementsByTagName('input')[0].value !== '') {
                allBlank = false;
              }
              sum += +rows[i].cells[columnIndex].getElementsByTagName('input')[0].value;
            }
            if (allBlank === true || String(sum) === '100') { // pecentages are correctly normalized
              clearNotices(); // clear notices which describe bad input
              for (i = 0; i < rows.length; i++) { // clear styling indicating bad input
                rows[i].cells[columnIndex].classList.remove('invalid-text-input');
              }
              for (rowIndex = 0; rowIndex < rows.length - 1; rowIndex++) {
                rows[rowIndex].cells[columnIndex].classList.remove('invalid-text-input');
                attributeName = fegsScopingData.fegsAttributes[rowIndex];
                attributesObject[attributeName] = rows[rowIndex].cells[columnIndex].getElementsByTagName('input')[0].value;
              }
              fegsScopingData.addAttributes(beneficiaryName, attributesObject); // save
              tableAttributes.showOnlyTheseColumns(fegsScopingData.extantBeneficiaries()) // update beneficiaries shown in #table-attributes
              fegsScopingView.indicateUnsaved();
            } else { // notify of incorrect normalization
              accessiblyNotify('The percentages for beneficiary ' + beneficiaryName + ' sum to ' + sum + '.  Percentages must sum to 100.');
              for (i = 0; i < rows.length; i++) {
                rows[i].cells[columnIndex].classList.add('invalid-text-input');
              }
            }
          }
        };
        for (var i = 0; i < rowNames.length; i++) {
          for (var j = 0; j < columnNames.length; j++) {
            //TODO implement excel-compatible keyboard-navigation listeners
            cell = table.cell(rowNames[i], columnNames[j]);
            if (cell.querySelector('input') === null) {
              input = document.createElement('input');
              input.type = 'number';
              cell.appendChild(input); // store data and set properties including callbacks before insertion into DOM to optimize performance
            } else {
              input = cell.querySelector('input');
            }
            input.onchange = validateAndSaveData; // apply onchange callback late to restore functionality
          }
        }
        table.table.setAttribute('data-initialized', "true");
        return table;
      };

      /** caculate and display beneficiary-scores */
      var displayBeneficiaryScores = function() {
        var attributes = fegsScopingData.fegsAttributes;
        var beneficiaries = fegsScopingData.fegsBeneficiaries;
        var rowHeader = 'Beneficiary Score';
        var rowOffset = 2;
        var columnOffset = 1;
        var table = new Table('table-beneficiary-scores', [rowHeader], beneficiaries, rowOffset, columnOffset);
        var i;
        var cell;
        var cellValue;
        for (i = 0; i < beneficiaries.length; i++) {
          cell = table.cell(rowHeader, beneficiaries[i]);
          cellValue = fegsScopingData.beneficiaryScore(beneficiaries[i]);
          if (isNaN(cellValue)) {
           cellValue = '0';
          }
          cell.innerText = cellValue;
        }
      };

      /** Prototype view to encapsulate representation. */
      var FEGSScopingView = function() {

        /** initialize the view of the application */
        this.initializeView = function() {
          this.showName.style.display = 'inline-block';
          this.changeNameButton.style.display = 'inline-block';
          this.inputName.style.display = 'none';
          this.saveNameButton.style.display = 'none';
          this.name = fegsScopingData.name;
          this.showName.innerHTML = this.name;
        };

        /** update name displayed in titlebar and header */
        this.updateName = function(name) {
          this.showName.innerHTML = name; // update the name shown
          this.name = name; // update the name of the view
          this.title = name; // call the name a title, too
          this.showName.style.display = 'block';
          this.changeNameButton.style.display = 'inline-block';
          this.inputName.style.display = 'none';
          this.saveNameButton.style.display = 'none';
        };

        /** input the name of this project */
        this.editName = function() {
          this.showName.style.display = 'none';
          this.changeNameButton.style.display = 'none';
          this.inputName.style.display = 'inline-block';
          this.saveNameButton.style.display = 'inline-block';
          this.inputName.value = this.showName.innerText;
        };

        /** save the name of this project */
        this.saveNameButton = function() {
          this.inputName.style.display = 'none';
          this.saveNameButton.style.display = 'none';
          this.showName.style.display = 'inline-block';
          this.changeName.style.display = 'inline-block';
          this.showName.innerText = inputName.value;
          fegsScopingController.saveValidatedData();
          this.name = inputName.value;
        };

        /** restore view's state: each input with a stored value restores that value */
        this.restoreView = function() {
          var inputs = document.querySelectorAll('input:not([type="radio"]):not([type="checkbox"])');
          var radioInputs = document.querySelectorAll('input[type="radio"]');
          var i;
          for (i = 0; i < inputs.length; i++) {
            inputs[i].value = inputs[i].getAttribute('data-value');
          }
          for (i = 0; i < radioInputs.length; i++) {
            radioInputs[i].checked = JSON.parse(radioInputs[i].getAttribute('data-checked'));
          }
        };

        /** indicate saved status */
        this.indicateSaved = function() {
          document.title = fegsScopingData.name;
          document.getElementById('menu').style.border = 'none';
        };

        /** indicate unsaved status */
        this.indicateUnsaved = function() {
          document.title = fegsScopingData.name + '*';
          document.getElementById('menu').style.border = '1px solid red';
        };

        /** save view's state: each input stores its own data */
        this.saveView = function() {
          var i;
          var inputs = document.querySelectorAll('input:not([type="radio"])');
          var radioInputs = document.querySelectorAll('input[type="radio"]');
          for (i = 0; i < inputs.length; i++) {
            inputs[i].setAttribute('data-value', inputs[i].value);
          }
          for (i = 0; i < radioInputs.length; i++) {
            radioInputs[i].setAttribute('data-checked', radioInputs[i]['checked']);
          }
          document.body.setAttribute('data-restore', 'true'); // set flag to automatically restore data on document load
        };

        this.pages = document.querySelectorAll('.page');
        var self = this;
        /** show only the identified page */
        this.focusPage = function(pageId) {
          var pages = document.querySelectorAll('.page');
          var pageIndex;
          for (pageIndex = 0; pageIndex < pages.length; pageIndex++) {
            if (pages[pageIndex].id === pageId) {
              pages[pageIndex].style.display = 'block';
            } else {
              pages[pageIndex].style.display = 'none';
            }
          }
          self.ensureNavigability(pageId);
        };

        /** add navigability if absent */
        this.ensureNavigability = function(pageId) {
          var navigation;
          var back;
          var forward;
          if (!document.getElementById(pageId).querySelector('.navigation')) {
            navigation = document.createElement('div');
            navigation.setAttribute('class', 'navigation');
            back = document.createElement('button');
            forward = document.createElement('button');
            back.innerHTML = 'back';
            forward.innerHTML = 'forward';
            back.onclick = function() {
              var pages = document.querySelectorAll('.page');
              var pageIndex;
              var currentPageIndex;
              for (pageIndex = 0; pageIndex < pages.length; pageIndex++) {
                if (pages[pageIndex].style.display === 'block') {
                  currentPageIndex = pageIndex;
                  break;
                }
              }
              if (currentPageIndex > 0) {
                self.focusPage(pages[currentPageIndex - 1].id)
              } else {
                console.log('there is no page before the first page');
              }
            };
            forward.onclick = function() {
              var pages = document.querySelectorAll('.page');
              var currentPage = document.querySelector('.page[display="block"]');
              var pageIndex;
              var currentPageIndex;
              for (pageIndex = 0; pageIndex < pages.length; pageIndex++) {
                if (pages[pageIndex].style.display === 'block') {
                  currentPageIndex = pageIndex;
                  break;
                }
              }
              if (currentPageIndex < pages.length - 1) {
                self.focusPage(pages[currentPageIndex + 1].id)
              } else {
                console.log('there is no page after the last page');
              }
            };
            navigation.appendChild(back);
            navigation.appendChild(forward);
            document.getElementById(pageId).appendChild(navigation);
          }
        };//////////// PROCESS IN PROTOTYPE FEGSScopingView ///////////////

        this.inputName = document.getElementById('input-name');
        this.showName = document.getElementById('show-name');
        this.saveNameButton = document.getElementById('save-name');
        this.changeNameButton = document.getElementById('change-name');
        this.initializeView();
      };////////////// END PROTOTYPE FEGSScopingView /////////////////////

      var getDocument = function() {
        var documentText = '<!DOCTYPE html>' + '\n' + document.documentElement.outerHTML;
        return documentText;
      }

      var downloadText = function (filename, text) {
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
      }

      var indicatePageZoom = function(event) {
        document.querySelector('#page-zoom-indicator').innerText = event.target.value;
      };

      var pageZoomChange = function(event) {
        document.body.style.zoom = event.target.value;
        document.body.style['-moz-transform'] = 'scale(' + event.target.value + ')';
      };

      ////////// PAGE-PROCESS //////////////////////////////////////
      var fegsScopingData = new FEGSScopingData();
      var fegsScopingView = new FEGSScopingView();
      var fegsScopingController = new FEGSScopingController();
      var criteriaColors = ["#4f81bd", "#c0504d", "#9bbb59", "#8064a2", "#4bacc6", "#f79646", "#2c4d75", "#772c2a", "#5f7530"];
      var tableAttributes = tableAttributesCreator('table-attributes');
      tableAttributes.showOnlyTheseColumns();
      document.addEventListener('DOMContentLoaded', function() {
        initPieChart.draw({
          data: getJSON(), // Get the data from the inputs
          element: 'pie'
        });
        if (document.body.getAttribute('data-restore') === 'true') {
            fegsScopingController.restoreData();
        }
      });
      updateStakeholderProgress();
      updateWeightingProgress();
      updateBeneficiaryProgress();
    </script>
  </body>
</html>
